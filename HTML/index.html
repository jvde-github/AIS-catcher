<!doctype html>
<html>
<head>

    <title>AIS-catcher</title>

    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="favicon.ico">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation/dist/chartjs-plugin-annotation.min.js"></script>

    <link href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.6.6/css/flag-icons.min.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <style>
                :root {
                    --primary-color: #0857b1;
                    --secondary-color: #12a5ed;
                    --tertiary-color: #0b1033;
                    --bottombar-color: var(--tertiary-color);
                    --panel-color: #f2f8ff;
                    --ok-color: rgb(129, 244, 129);
                    --error-color: red;
                    --stationCircleColor: yellow;
                    --header-color: var(--primary-color);
                    --header-title-color: #0e6cd8;
                    --selection-color: orange;
                    --mainspace-color: white;
                    --backdrop-color: #f5f7fa;
                    --focus-color: red;
                    --light-gray: lightgray;
                    --header-font-color: white;
                    --menu-background-color: white;
                    --leaflet-control-color: white;
                    --menu-divider-color: #ccc;
                    --menu-border-color: #ccc;
                    --dialog-title-color: var(--secondary-color);
                    --menu-background-hover-color: #daebfe;
                    --menu-font-color: rgb(66, 66, 66);
                    --chart1-color: rgba(93, 169, 213, 0.7);
                    --chart2-color: rgba(157, 93, 213,0.7);
                    --chart3-color: rgba(93, 213, 97,0.7);
                    --chart4-color: rgba(213, 157, 93,0.7);
                    --chart5-color: rgba(93, 213, 154,0.7);
                    --chart6-color: rgba(211, 211, 211,0.7);
                    --chart-color: rgb(66, 66, 66);
                    --chart-grid-color: lightgrey;
                    --mainspace-container-color: lightgrey;
                    --table-header-background-color: var(--primary-color);
                    --table-border-color: lightgrey;
                    --table-background-color: white;
                    --table-selection-background-color: #daebfe;
                    --table-alternate-background-color: var(--panel-color);
                    --range-color: orange;
                    --main-font-color: var(--tertiary-color);
                    --stat-label-color: var(--tertiary-color);
                    ;
                    --stat-divider-color: var(--tertiary-color);
                    ;
                    --stat-color: var(--primary-color);
                    --shipcard-header-color: var(--secondary-color);
                    --shipcard-content-color: var(--menu-background-color);
                    --shipcard-content-hover-color: var(--tertiary-color);
                    --shipcard-footer-background-color: var(--tertiary-color);
                    --shipcard-footer-hover-color: var(--primary-color);
                    --shipcard-selection-color: rgb(240, 241, 248);
                    --shipcard-divider-color: rgb(217, 218, 218);
                    --shipcard-footer-shadow-color: rgb(218, 218, 218);
                    --hover-transform: scale(0.93);
                    --hover-transition: transform ease-out 0.2s, background 0.4s;
                    --hover-background: rgba(255, 255, 255, 0.5);
                    --graph-header-color: white;
                    --graph-header-bg-color: var(--primary-color);
                    --graph-header-side-color: rgba(242, 248, 255, 0.5);
                    --tooltip-background-color: #daebfe;
                    --tooltip-border-color: white;
                }

                .dark {
                    --primary-color: #5DD5D5;
                    --secondary-color: #5DD5D5;
                    --tertiary-color: #05081f;
                    --bottombar-color: black;
                    --panel-color: rgb(18, 18, 18);
                    --ok-color: #7ce481;
                    --error-color: #cf6679;
                    --stationCircleColor: darkgrey;
                    --header-color: #323232;
                    --header-title-color: #4a4a4a;
                    --selection-color: #9fa8da;
                    --mainspace-color: black;
                    --backdrop-color: black;
                    --focus-color: #90caf9;
                    --light-gray: lightgray;
                    --header-font-color: #f8f9fa;
                    --menu-background-color: rgb(41, 41, 41);
                    ;
                    --leaflet-control-color: rgb(60, 60, 60);
                    --menu-border-color: rgb(17,17,17);
                    --dialog-title-color: rgb(50,50,50);
                    --menu-divider-color: rgb(17,17,17);
                    --menu-background-hover-color: #4d4d4d;
                    --menu-font-color: #f8f9fa;
                    --mainspace-container-color: #212529;
                    --table-header-background-color: rgb(50,50,50);
                    --table-border-color: rgb(18,18,18);
                    --table-background-color: rgb(18, 18, 18);
                    --table-selection-background-color: rgb(40, 40, 40);
                    --table-alternate-background-color: rgb(30, 30, 30);
                    --range-color: rgb(15, 46, 77);
                    --main-font-color: white;
                    --stat-label-color: darkgrey;
                    --stat-divider-color: rgb(50, 50, 50);
                    --stat-color: white;
                    --shipcard-footer-background-color: rgb(40,40,40);
                    ;
                    --shipcard-header-color: rgb(50,50,50);
                    --shipcard-content-color: rgb(13,13,13);
                    --shipcard-content-hover-color: var(--tertiary-color);
                    --shipcard-footer-hover-color: var(--secondary-color);
                    --shipcard-footer-shadow-color: black;
                    --shipcard-selection-color: rgb(25, 25, 25);
                    --shipcard-divider-color: rgb(17,17,17);
                    --chart1-color: rgba(93, 169, 213, 0.7);
                    --chart2-color: rgba(157, 93, 213,0.7);
                    --chart3-color: rgba(93, 213, 97,0.7);
                    --chart4-color: rgba(213, 157, 93,0.7);
                    --chart5-color: rgba(93, 213, 154,0.7);
                    --chart6-color: rgba(211, 211, 211,0.7);
                    --chart-color: lightgrey;
                    --chart-grid-color: rgb(56, 56, 56);
                    --hover-background: rgba(255, 255, 255, 0.1);
                    --graph-header-color: white;
                    --graph-header-bg-color: rgb(41, 41, 41);
                    --graph-header-side-color: rgb(32, 32, 32);
                    --tooltip-background-color: rgb(60,60,60);
                    --tooltip-border-color: rgb(30,30,30);
                }

                body,
                html {
                    height: 100%;
                    width: 100%;
                    margin: 0;
                    font-family: Arial;
                    display: flex;
                    flex-direction: column;
                    justify-content: stretch;
                    -webkit-user-select: none;
                    -ms-user-select: none;
                    user-select: none;
                    -webkit-touch-callout: none;
                    overflow: hidden;
                }

                .header {
                    background: var(--header-color);
                    flex: 0 0 40px;
                    font-size: 20px;
                    display: flex;
                    justify-content: stretch;
                    color: white;
                }

                .header-title {
                    flex: 1;
                    background-color: var(--header-title-color);
                    border-top-right-radius: 25% 50%;
                    border-bottom-right-radius: 25% 50%;
                    display: flex;
                    flex-direction: row;
                }

                    .header-title span {
                        padding: 15px;
                        line-height: 20px;
                        padding-right: 50px;
                    }

                    .header-title div {
                        padding: 15px;
                        background: var(--header-color);
                        margin: auto 0;
                        border-radius: 20px;
                        font-size: 15px;
                        line-height: 15px;
                        padding: 10px 15px;
                    }

                .small-icon {
                    font-size: 18px;
                }

                .tabcontent {
                    /* 0% does not work and minify changes that into 0% */
                    flex: 1 0 1px;
                }

                .addscrollbar {
                    overflow: auto;
                }

                @media only screen and (max-width:750px) {
                    .header-title div {
                        display: none;
                    }
                }

                .header-title div.show {
                    display: none;
                }

                .header-title div i {
                    padding: 0px 14px;
                    font-size: 18px;
                    transition: var( --hover-transition);
                }

                    .header-title div i:hover {
                        cursor: pointer;
                        transform: var(--hover-transform);
                    }

                    .header-title div i.active {
                        color: var(--secondary-color);
                    }

                .header-icon, .header-pulse-ok, .header-pulse-error {
                    width: 35px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: var( --hover-transition);
                    font-size: 15px;
                    line-height: 15px;
                }

                .header-pulse-ok {
                    color: var(--ok-color);
                }

                .header-pulse-error {
                    color: var(--error-color);
                }

                .header-icon:hover {
                    cursor: pointer;
                    transform: var(--hover-transform);
                }

                .header-menubutton {
                    background: var(--menu-background-color);
                    color: var(--menu-font-color);
                    transition: var( --hover-transition);
                    font-size: 24px;
                    width: 40px;
                }

                    .header-menubutton > div {
                        padding: 15px 9px;
                        margin: auto;
                    }

                @media (hover: hover) {

                    .header-menubutton:hover {
                        cursor: pointer;
                    }
                }

                .bottombar {
                    flex: 0 0 15px;
                    background: var(--bottombar-color)
                }

                #realtime_content {
                    background: var(--menu-background-color);
                    color: var(--menu-font-color);
                }

                #menubar {
                    z-index: 9999;
                    background: var(--menu-background-color);
                    color: var(--menu-font-color);
                    text-align: center;
                    align-items: stretch;
                    display: none;
                    flex-direction: row;
                    visibility: visible;
                }

                @media only screen and (min-width : 750px) {
                    #menubar {
                        position: fixed;
                        top: 60px;
                        left: 10px;
                        right: 0;
                        width: 500px;
                        border: solid;
                        border-color: var(--menu-border-color);
                        border-radius: 20px;
                    }
                }

                #menubar div {
                    flex: 0 1 150px;
                    margin: 0 10px;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    transition: var( --hover-transition);
                    display: flex;
                    flex-direction: column;
                }

                    #menubar div i {
                        padding-top: 10px;
                        padding-bottom: 10px;
                        font-size: 24px;
                        line-height: 24px;
                    }

                    #menubar div span {
                        padding-bottom: 10px;
                        font-size: 10px;
                        line-height: 10px;
                    }

                @media (hover: hover) {

                    #menubar div:hover {
                        background: var(--menu-background-hover-color);
                        transform: var(--hover-transform);
                    }
                }

                #menubar div.active {
                    border-bottom: 4px solid var(--secondary-color);
                    color: var(--secondary-color);
                }

                #menubar.visible {
                    display: flex;
                }

                .mainspace-container {
                    flex: 1 0 0;
                    /*overflow: auto;*/
                    background: var(--backdrop-color);
                    border-top: solid;
                    border-color: var(--mainspace-container-color);
                    border-width: 4px;
                    display: flex;
                    flex-direction: column;
                    justify-content: stretch;
                }

                .mainspace {
                    background: var(--mainspace-color);
                    margin: 20px;
                    flex: 1;
                    border: 1px;
                    display: flex;
                    flex-direction: column;
                    justify-content: stretch;
                }

                @media only screen and (max-height : 1000px) {
                    .menubar {
                        display: flex;
                    }

                    .header-menubutton {
                        display: block;
                    }

                    .bottombar {
                        display: none;
                    }

                    .mainspace {
                        margin: 5px;
                    }
                }

                /* Plot styling */
                .graphtab {
                    padding: 15px;
                    display: grid;
                    grid-template-columns: 1fr 1fr 1fr 1fr;
                    column-gap: 15px;
                    row-gap: 15px;
                }

                @media only screen and (max-width:2250px) {
                    .graphtab {
                        grid-template-columns: 1fr 1fr 1fr;
                        padding: 5px;
                    }
                }

                @media only screen and (max-width:1500px) {
                    .graphtab {
                        grid-template-columns: 1fr 1fr;
                        padding: 5px;
                    }
                }

                @media only screen and (max-width:800px) {
                    .graphtab {
                        grid-template-columns: 1fr;
                        padding: 0px;
                    }
                }

                .graph-panel {
                    padding: 10px;
                    overflow: auto;
                    background-color: var(--panel-color);
                    border-radius: 15px;
                }


                    .graph-panel > header {
                        margin: 20px auto 30px auto;
                        padding: 5px 0px;
                        border-radius: 10px;
                        max-width: 400px;
                        width: calc(100% - 30px);
                        align-items: center;
                        border-left: 10px solid var(--graph-header-side-color);
                        border-right: 10px solid var(--graph-header-side-color);
                        background-color: var(--graph-header-bg-color);
                        color: var(--graph-header-color);
                        text-align: center;
                        font-size: 1.0em;
                    }

                    .graph-panel > canvas {
                        width: 100%;
                        height: 100%;
                    }

                .aboutpage {
                    background-color: var(--panel-color);
                    color: var(--main-font-color);
                }

                /* Table styling */

                #shipTable {
                    max-height: calc(100vh - 135px);
                    max-width: 100vw;
                }

                .tabulator .tabulator-cell {
                    border: dashed thin;
                    border-color: var(--table-border-color);
                    padding: 10px 15px;
                    font-size: 0.9em;
                    color: var(--main-font-color);
                }

                .tabulator .tabulator-header {
                    border-left: 10px solid var(--table-header-background-color);
                }

                    .tabulator .tabulator-header .tabulator-col {
                        background-color: var(--table-header-background-color);
                        font-size: 1em;
                        color: white;
                        border: none;
                        padding: 25px 15px;
                        border-collapse: collapse;
                    }

                .tabulator-row:hover {
                    background-color: var(--table-selection-background-color) !important;
                }

                .tabulator-row-odd {
                    background-color: var(--table-background-color);
                }

                .tabulator-row-even {
                    background-color: var(--table-alternate-background-color) !important;
                }

                .tablesection {
                    font-size: .8em;
                    display: flex;
                    height: 100%;
                    margin: 10px auto;
                    color: var(--main-font-color);
                    background-color: var(--table-background-color);
                    width: fit-content;
                }

                /* other tables */
                table {
                    height: 100%;
                    overflow: auto;
                    border-collapse: collapse;
                }

                    table thead {
                        background-color: var(--table-header-background-color);
                        font-size: 1em;
                        color: white;
                    }

                        table thead > tr > th {
                            padding: 25px 15px;
                            border-collapse: collapse;
                        }


                    table tbody th,
                    td {
                        border: none;
                        padding: 10px 15px;
                    }

                    table > tbody > tr:nth-child(even) {
                        background: var(--table-alternate-background-color);
                    }

                    table > tbody > tr:hover {
                        background: var(--table-selection-background-color);
                    }

                .show {
                    display: none;
                }
                /* Map styling */

                #map {
                    height: 100%;
                    width: 100%;
                }


                .maptab {
                    height: 100%;
                }

                .round-control {
                    border-radius: 50%;
                }

                @media only screen and (max-height:300px) {

                    .min-height-300 {
                        display: none;
                    }
                }


                .shiptable-map {
                    width: 10px;
                }

                .shipicon {
                    background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAAoCAYAAAB5LPGYAAATHElEQVR42u3be3BU130H8O8599593H2BpJUwRgIhHlrJKwsQSCCJlWweIyLXBo+BWDZqhqi0zTgKSWcoQ6d/dPpHp4SSNDOdEcqOChlSO8UiMSi2k9iKi2RbjhCGBUEAFyyBESteq9Xu3d37OP3DKs56tbpXjz86U/1m9Me95+qz59793d8597HAbMzG//VwNbpEV6PLPlPe7uxd4u7sXTPmzcttEuflNs2YV+XlxCovN2PeNqtD3GZ1zJhXW20Wa6vNM+aJheWiWFg+Y169xSvWW7yGPGpIpNx+UG7fTHWQgu6noPtm7hSh+zGDHgH2E2DGPA7Yz82gx/PYz/Mz54Hy+0H5Gdxfup8z+H0QA9XPKm/fMAAAwi9+lxc6GpKmWf2sL8Z3DADAm+Y38vzBY9Py5uU2WeOxrQMAYLaczBsabJ2WV+XlrBUsewAAPibBvK6AOi1vm9Vh/XNFHgCAf+eFvHYpPC2vttpsfe176gAA/ORHXF7nmfi0PLGw3Mpv/usBAFDe/be86JWeaXn1Fq/126aKAQD4aeLjvNOxgDTdCvhKfPWirPjqRVkAXpmBE+SVsujqrLLo6hnzIuGyrEi4bMa8AmbPKmD2GfPKVTmrXJVnzFtXqWatq1RnzOOWr8nilq+ZMW8tn5+1ls835OkmoLJxbbPqtkN126FsXNs83d49I29sdstuuGU3npE3TtuTE7XNiZgbiZgbcqJ22p6XZTQ7mQAnE+BlGdP2nlOV5mxNRbam4jlVmbb38qtac04OQ04Ow8uvatP2uModzcSVDeLKBle5Y9reNt7bnE0dyKYObOO9zdNKQFejy5eoWFz8v8uJisXFrkaXbxrDr688tvaxVx5bW7w7e9eUvXm5TT4puuaxJ0XXFM/LbZqyV+XlfEuZ47G3lDmKq7zclL1tVoevUpUfe5WqXLzN6piyV1tt9q33qY+99T61uLbaPGVPLCz3cZ7Kxx7nqSwWC8un7NVbvL4qoeCxVyUUFNdbvL4pJ6Dm9eyTC9xfVZsCNzSvZ8qT1WK1ZF+BVPB4uUAqQLFaMmVPVYv2RcNfedFwAVS1aMpeLuz7cpjl8XIOsyAX9il7ZZq2b6mqPF5eqioo07Qpe+tr2b5ly7THy8uWaVhfy6bs0cLqffSJJV8tP7EEtLB6yl45l7dvKZf91f5y2Sjn8vZNKQFdjS5Porao7uvrE7VFda5Gl2cK1c9TE69N8WritXW7s3d5plD9PDHJl+LFJF/dvNwmzxSqn6dYm5PiFWtz6qq8nGcK1c+zUZVTvI2qXLfN6vBMofp5tmxRU7wtW9S62mqzZwrVz8Ot2JTicSs21YmF5Z4pVD/PZsGT4m0WPHX1Fq9n0gnIsnOaE975KesT3vlg2TmTniu4WXbzUxFvyvqnIl64WfakPcaymkdDT6WsHw09BcayJu05ITTnMTFlfR4T4YQwaW8+Y81PK3LK+qcVGfMZm7SXv5g1r1ippqxfsVJF/uLJe8Sd38zll6TOCfNLQNz5k/YWEFdzKb8gZX0pvwALiKt5gltU41a/zMRLvjalwG1K/Q8KIpg9Ngy2xM8buwWwO3tX5ovx7W2L4wWm1A5wEHiTh3OxlnOR85LB6pcZk7a2xaKLU/vHOPAC75mbJbSMjvRJBqtfZgXLbsthFlPqGUrAE+phOdGWgSCTDFa/zFdVuW2JppjGO+BmQjyjZrHlspKQDFa/zL/8jta2bJmW6nGAVSSe258LLTcHjN0yEgvLM/mN326jTyxJPX6UA0xWD3d/oEW+d1syWP0yv2Uqb1vKZY+zvxQW8J6HJNZyVQlKRitgY2LVQlu6Dxxra5zECdK4KrIqrTfWNikvMpLeG2ublLdYs6f1xtom5a1R5LTeWNukvIoKNa031jYpj1u6Oq031jYpr1xYlNYba2s0VAFdjS4iP19zMvH0grSPUpiZB8cspaJl6FD8fFyv+pHnEi+cLJGeTuuZmBlMQKnNaT50LnJer/qRRPwbJyPhkrSepplgsmilrgzHodGRPr3qR8pY1smFzJbW40EBQkr5nNihgSDTq37km6pycoUqp/XMYOAoV6qarIcuKwm96kf+4q+0k6vK1PSeGTBbaOmDoHDo5oCqV/0I9+zuk9zi0rQeEcxggqWUDwcPyfdu61U/8qpQdnIln5u+f4QHz0hpjKqHripB3QrYkKjIz0nqkKKCKMk7NrZNg4Gzo2FNtDzJU4gChSjJVeHLbQx5kdE1yf2jCghN9sa2MeQtYY4kTwWDiuREG9vGkLdOSSTvLwiUrz10GtvGkFddrSZ5svzl35/G2DaGPK5wbU7y7QTly78/rUxfbmPIqxQWJ/cPKmQk58vYNg26FVB4rcofW79sPgBww6OwfPjZqLX1/Tbze/1nKbhC5rSamM0EzWGBcF/JS7x1o3Wi3r1mfs1fPeqbDwD3hGF86Oge9Tta2zrF985CYIVOzWkSNRscqgP3zQ/yfiW9NaFnEV/zhx9WzwcAk+UeHHM+HHXNbWuzOX5/VjCxQk1zmlRFhCo7YBHv50VHfzWhtyk7w+9hrvkAMEJk/JGGR9+nd9ou0kdnQUihFZzJDA5WcBglal5fUJrQ+y7H+2uVxHwAGKYczvDm0Z+YLG3v8qazlNBCF5jJxhgcjOEhx+d1qPKE3vd/QP0bNqrzASAYJOjs5Ed/+M982+lT3FmOJ4Vz5jCTzQY4nQwjYZr39jvahJ657jt+3ls7HwBYaBhqf9eofOrHbWrfO2dB+UIiukzEYgOxOqBJo3mJC+9N6DVbavzPCsu/7J8Wxgfy9dEfx37f9rbcf5aCFLqI1WQjZjiJBY+0aN6vE5eSPPK14bdS+sH2LvAUpo8/6+U++EMrgOOho6HIWLsNQIPqW92UqCgog6LBeugXVaGjoe40w2/l9yJ/08UzHh9bPurt4j9oBXDcHzwWGWu3AWioUnxNFbG1ZQpR8CPbD6v8wWPdaYbfytGR73YxxsMq9vTyQncrgONDg62RsXYbgAZFrmySouVlhCiwO/+1amiwtTvN8Fv5DS23iwPBNTLSe5k8agVwvCugRsbabQAaPGxO01LmLFPB0EEHq7oCanea4bfy7+VYl8CALl7ofZdyrQCOt0vhyFi7DUDDZk1tqlLkMpkA/yBYqtqlcHea4bfyX36sdPEC8MHvae+bv6CtAI53nolHxtptABpe3K41+Wq0MkUGvt/MV3WeiXenGX4rhVf/qQucALW/q1f75GQrgOPRKz2RsXYbgAa6ZmsTV1RVBlWG/LO/rYpe6elOM/xW/qNlSxcPDmeU670dyuVWAMdPxwKRsXYbgIZv8J6man5JmQIVfxf7ddXpWKA7XQIeZvmLRHLjZkvoaKhP5ynJSpa/aA+5cTMaOhramyYBDy/U8sXP6Y0Wf/BYn85cceVCLX/P5/RG1B88tjdNAh7WtDyR0oGWocHWPp254kpNy9tD6UB0aLB1b5oEPOyGRRxGrKUroPbpzBVXumHZM4xYtCug7k2TgIeXMSZeJaSlXQr36cwVVy5jbM9VQqLtUnhvmgQ8XFLKxAufkpbOM/E+nbniypJStufCpyTaeSa+N00CHiZ5JSIbuNASvdLTpzNXXEnySvawgQvR6JWevWkS8LCHZouXtWDL6VigT2euuNJDs/dc1oLR07HAXszGbMzGbMzGbMzGbMzGbMzGbMzGbMzGbMzGbMzG/5sw9Ks4AB4ADMCnoaMhNp0P3J29K8nzB49Ny5uX25TkDQ22Tsur8nJJXldAnZa3zepI8tql8LS82mpzktd5Jj4tTywsT/KiV3qm5dVbvEne6VhgQo+fIPGKWF7ewcS65XXqgrkEAPirdyVnxqUT5MG9A6GjocFJJl5RrrbwYEV8Xd0CeQFhhOG6cE2a68448ZA8OOAPHhucZOIVadqCg/FYRZ2ceJIADCbzdSlnwdwThDw8MDTYOjjJxCvKguXgUuasy2RmAgB3iCTZvY9OjEI50BVQByeZeEVLGDu4XpHrcplKAOCPlJeyLfYTQUIOtEvhwUkmXlFxCTu4YaNat3AhIwBwuZ9KT+aaT9wexIHOM/HBSSZeEVlQfJDz1tYRdy4BA7Tbf5RsGU+eYA9uH4he6RmcZOIVLaPugzX8krqFNIMwAFfUISmHOE7cZeEDp2OBQcMV0NXoqlE2reuIblspMktyjtJwDOLPe25xH53bHDoa6jeYfDXPyps6toVeFM2aJaktzIXxuuv4rR7+o83+4LF+g8lXIyee6Xh4b6uoqebkM0oIY07W67d4/g+bhwZb+w0mX00Jy+hYo2WKwtdeEJKgopsO37pGQpu7Amq/weSreV5VOrbLMdHCkgtAmFAcNVludVJuc7sU7jeYfDUNu7SOhlcU0WJJ9kZGCH7ayt86/Su6ufNMvN9g8tVwlTs7hOrtIoTk74NJYcjvHb2lnfv15uiVnn6DyVfzIl/SsdO8SrQQIbl/LIa22Me3fqde3Xw6Fkjxxnsf0K2uL+uJNpTbmCn1hWlm5iE/nesUrj/aYH0y4o+fjys6yeeuUnw9Lz96xSaw1BdwzcyMktjTzuvWaxvy7E/6z0XOKzrJ51bkdT0Pgt+0MU1Iadc0M6RoiVO0Xd/gmLPIPzrSp+gkn7uQzemp0tw2fpy30wRQLGQ25xCNbZibo/gHgkzRST73Jk3taUxINtM47WYwrFAV5zWe35AhWPyXlYSik3zubS9pPd9ukm2mcUCzGShbrTk/+4zbwBPef3NAVXSSz01Xv9BjerbRBj4VJIIZXMEKpzp0c4NA4Zfv3VZ0ks+9hff0fMuy1mYiqQOqmfBYJeQ6rynBDQ7O6r+qBJO88d4HbJa2rrQzLv0P5pjAIf7CquUAthg4QZqfH9lq5xiXdgOBCXg+stWwF3r4vJ1N4DFNQGT0zwx7a7RMO51gOsyBoEzLNOy9lIjZ+Qk2EMCwXU4Y9l5uUOz8BKAgAA2vKoY9oeolO2j64wdOgFC13bC3w7TKzk/wA0sBHHaaxs+XlP9SK0p96lxR91MTy3PA3Nmb9LZbrVT45ipzdb1l0nJkMbeupyhlPjmu70VGloGxTF1vCXP6bOB1vfnMCgcEXc+nqb4Mpul6haqMeYzpelue03wZGfrXBUVFGhYugq5HS+t8xK5//OiCQpCshbres9xSXwbVzxcPPw/ziXOTbgIqT+VajU481TXLdb+5p2SvYa9MKdf15ESxYU+Wy3S9XNgMe0uYU9cr1VTDXpWm6nqrVjHD3jMbNF2PLi417NFin663gl9g2FvPF/C6CcgN3jd8GU6vfqF7qg/yg4a9a9xVXY/nbxn2eP66rncfxm9j3CFRXe9zQg17lynV9W7cIIa9wAWi67Hg54Y9bfCSrndTfWDY61eHNN0E5H/b001isv6XeycEeu2zXr3t3hd+0x2jMf0v1/QFPqNXdT3B1NnNcfqeWbwDSvX7FyAPuhPQHzIfkgSGIOl6pzi+WyK6t1fxBeVwiVBd7z+O025J0vdu36Lo/YToeuqHb3QzA78G1R58AfbfZ3W9k8qFbonp58tt7REuaHd6dRMQmnrE+m7/xFnNAMtbn94HcEJ3R6Ad+Y3zXTYxx3DafsqQB2hHXJm/1TnrGByuDkMeA45coI90z+Kz5IEhTwWOvC2YdfYXaBfMxjwFR069xU3sMeCNNzhjx09Tjyhn39E9fspH7Qb3lx3pSFzU3d834+PnS8qlUPx8fFg037lLXXPrlfys1Mt0RYPYEZD43360I3Q0FNDr4LnI+WGb03TXwbnq8+P5qRcVRMHbczqk94Tf7PAHj+l6oyN9w64M+13e5KiPRRel9o8qmJv1tmQyvb9jaLBV1xsIsmE+R7orEqE+m1nGO8A4Rx9KAfJgR1dA1fUuK4lhxWS9m0lI/WIt9SeSCgjeMlmktzh+R7sU1vVuDqjD9+8Kd+c9QeqXLNHGuSgD2t/kpZ//jNvReSau68n3bg/zI3fvYs68ejpv8bgZL39yStK6X98RvdKj611VgsMSVe66IdYXcO5x9lfDL+PnpXblwo7TsUBANwHHkrDXhsGLwlDMB4vJDkpAIwmYLn0B65u9/XznJztDR0PvGx37z0XO9/IuXBwy3/WZicVOQRHlIrgkXsJJx4n+D4TOnf7gMcPe6Ehf75xM00WLbchHOYsdhILjo7A5LsE595f9gunMzqHBVsPeQJD1spzoxUdE9pnA2SkB4kTDLSKhh97r7yePdnYFVMPeZSXRGzGLF4Mc77MS2CkIooQiwAl4XbD0v83xO9ulsGHv5oDae3tAuHjvPvWJIrFTCkQiBOc/5XDsmND/n6/TnZ1n4oY9+d7tXu7+wEUt/MAHk2gnlANiEWifX4TyX6/3az1v7oxe6THsXVWCvQ9J7GJQHfFZicnOgSLC4rigfIGfJ3r7TymXdp6OBcb1JpxcuBpdBEAlvnq296HRpx9pbkqneEaffqS5KZ3iGX36keamdIpn9OlHmpvSKZ7Rpx9pbkqneEaffqS5KZ3iGX36MV7UW7wp3nhPP2ZjNmZjNmYDAP4HqVQD1I/1cCYAAAAASUVORK5CYII=");
                    width: 20px;
                    height: 20px;
                    opacity: 1;
                    display: inline-block;
                }

                .staticon {
                    background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAUCAYAAADRA14pAAACXUlEQVRYhe3Ru47aQABG4UMWKSGJUJRqW9JlN+yKJim59duQBwD2kShyqXBtkheghJ4KF0gICewCISxRMgg7BYYYe2ZtME0uI42EMDr6Pwz/j/S8A1L/Su9+MGCmaXy5UPQeBjPQLtYbwEzjMvvuDAPTdXGFYKNpfE0YvQPDBNcFsQEtcc8A0wVXwEYj2b68YWC5Lu7+JkTnwbB22P1NhM4bYPliidAfglgJ+tkpvTA2hD6pF8RK0LF7SmwA/S1m9AnsETp2T4UNoGP1bqOwfnS7HRm9jcb60e3IXhTWj25HoG9k2NGIZb9PazhkokB/V0Rv5NjREvotGE4UaGVPhh3Bsg+tIUwUaGnvvQy73SIKBR6833xarRAStPDQV/6eHLsVUDj0YCUkaOGhj3oy7BZEAd8+EBK08NBX7OW1GtfZLC8k/6qby/Ha+/wmlcIN/iCdhkyGt8Dz/XcpateQlfYgd+hBKtSDNJA56n2G6yyKffj2IdkHZDjeB0C9TtU0sYNv0LKwez264zGL4DPHQeg6P4GX4S31Kph2+A1aNvS6MF6EnzkCdGmvDlUT7OAbtMDuQXcMi+AzB4SOah/QaFCRoWXXw/5QxnbFihwtu44A/cleAyoytOx62Ih9MdHxsKego7GnoGNj96fZpKxCe9hO7NiuWFajHQH6Sb0mlFVoD3vivh26FEQ7DutO54zYrlgKo501dM7qNaEURDuw7pyDPUR9aA+rA6/Oiu2Kpd9oZw2dRD0/2sMm3Ac8PlKcTpknxx6KRZjOk2IPNShOYX4RrO98vGTsD+j9PecXIj9PVcetObkAAAAASUVORK5CYII=");
                    width: 20px;
                    height: 20px;
                    opacity: 1;
                    display: inline-block;
                }

                .planeicon {
                    background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAACt0lEQVRIx7XVT2hcVRTH8c9MJ5kwo5kEkv5Bilpr20j8E62xCyHZuHGhIM1CaXfWTUGoglpQF+rGZRE3BRVpEaSC1V2oGxcVsVhEIYZYK60UkyZmZpJmMs1k3nXhDQzTRidt8oPL475zzv3ec96959G6XkHYLl1FwKs2QD/t1zlf9uTkfp3z+Hm9Ae1YHNVfDobDGf0lVJFrJTjdImQ7Ou6Tq0F8ZnHPekKy0Ks9A1tlM2spQ3otzlnp8G9QyoZBblWtQB7Cx6vYTuCx29lAG97GEmof2TlZN1QNhkPdUPWE+yexHO3vRP81aQDnEZ7TWbxgcDIYDs3jd4N/HdA9Fy/n+Rh3g1I3uQ9v4nVkTto1PWJroV26Y7XdLEmqp0yWD5jojZm9j/dihjdA9uJTPPCCrrl37arukNvcauoXVa6+ZaLjM6VOjOEQvluBtEXyEaRO2VN81pZ8m1QOSdly+aJKeyKkd8qHgkxuzvLCbxbSaalkh9xSQaaAdE2ofGVqYcR4VzxUH+Ao/IpwUHfxkiemaoYq4x6f+cKe4vO6SrHeAeGcgcVgOJwzsNj4fkSh9Lnds2P2TtcMVa7YN/uSntlo/wXqL9s8dlrflaO2Xc1LrXTZ6/g2fqNHMNEEmcLDeC36LSLkpapv2DZzWt/lw3rHUYekYVcX8CGeQWdT2cdG9U8Hw+EbD87Eujfqzhh3LK6zsmaSiRftB5zBpQi9mUo1SQ9U1RNca7LP4+s4juBuPIXBDF5s8QCVm+Z//4dvgj9wHMfX1LtKlvNQUc9uVIMsBiEN1yXt8ae1rpAM7m16txs96wXZhE+w7w6ZGmyRXUAfRtHVygL/p2M49LT8nwfdJaFekNmUVb981rV+PIovUbvVdn+44bzXELqlluK82mA7eTvlamzdY/ixKLThe5yNADGbVfUPx0b/bFzy3uUAAAAASUVORK5CYII=");
                    width: 25px;
                    height: 25px;
                    opacity: 1;
                    display: inline-block;
                }

                .helicoptericon {
                    background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAADxUlEQVRIx61VXWgcVRg9d+7Mnd3Zmd1N405oE5KakLbYgDTFH5BUEFo1WJuUNkiLEkVFxSb4UEVsUCutbWPAH1y10qAP2tJa6kMJltKU+CDqKmxQMNZV2ZikSkKSNTP7Mz97fcnCMuxuNq3n8Z7vO+fe7565A6wOr3wSDM5up/RL3AS2UuAogJoSXPiYovwV13V+OhRaAnBvGY37KPAmAFJYEDwFzW+r6r49ongRQJ2H69zq96sAsFGW6TrgwRIGe48oyqdPMdZVyeTcAcOIdvh8Db2S9BWAhgJRA2yIUBpcbvL3+nxtnt7HBwOBwWnHSX1oWT0A8uVMAOBEv2Gc2MyY9jRjlwC0AMB+xjYW10cobS/a7fNDgcDAhGWlopbVBeCnYkGhzFzfP2iabzSJotQny5cAtNWLYlNxwS2iuGb57l5+V1UP/pjLzZ6y7YcAJLxitEIIxkdte+ZhWd7VLgjddaJY3yhJSoHMcb54JZttf0vT9n6dzSbPOE4XgJlSQnSFtP0yats/389Y13ZVrSNFJw8IArmbMe28aV674Lq7AMyVExFWMFkPoHHOdVPEsyGREH8mn1cuuu73ABqL0+QFKeO8+5Dff6iVsfVNkiQHBUEpJ5DjPDdt2/nfLOvvkWz2s7F8fsBbI5ZqfEKStu3WtC3VfL0yIXIzY2hm7FZFELrHDKM6k89t+1pbOp3QKQ01SVIgUOEkNufmjOPwSdv+N5bLjVc9riJsALDvPVXt71CUcIlRzW2bnU3mgD4AMQD2jVy8uV8UOzmQOT4/H8sD2QJxfmkpNriw8PuQqq7VgZ0AnBt5LFselaTYUCCQBHAAwCNXa2sX47rO47rOd1IaBaB1Uno5qml/rAPeKTf+critj7GJo4ryK4Dewui+CIdTcV3nP0QiBoD+5XXfPYJw4aSmJbcQMlytUfsLspw4oihTAHqK1tWPNG0xrut8tLZ2EcCe4pDdQcjpU8HgP3cKwjkAcsX/yYs+X+J1v38SQKeXPKYo38V1nZ8Nh1MAWr1JvZ2Q4Y81bXIHpSOVnvqWaceZfzWTeQzAiNfkuutOAsC860oAkh7aGef8ycOGcSZMSH0VoSqNTYS8Ftf1/HFF+WY1fatym+B8Lsu5Ne26U6vpqyYJzwIgD1DasFkUO1zOxRpB2PQcYx9ELetPAD4AhysJkBUdGBvuDYW6ZUJC3nqHc/OKaV5/KZ1uvamTcCD/bSZjraHU0CmlEVGUFlzXnHddOmXbbppzEf8DegCMAVgLYMddgpAA8AyAZgADAE6uJPAfk1U+b+R6xyUAAAAASUVORK5CYII=");
                    width: 25px;
                    height: 25px;
                    opacity: 1;
                    display: inline-block;
                }

                /* Shipcard styling */
                #shipcard {
                    top: 10px;
                    left: 10px;
                    width: 400px;
                    display: flex;
                    flex-direction: column;
                    justify-content: stretch;
                    z-index: 9998;
                    position: absolute;
                    visibility: hidden;
                    background: var(--shipcard-content-color);
                    color: var(--menu-font-color);
                    cursor: auto;
                    border-radius: 15px;
                }

                    #shipcard.visible {
                        visibility: visible
                    }

                #shipcard_content {
                    flex: 1;
                    overflow: auto
                }

                #shipcard_header {
                    flex: 0 0 35px;
                    padding: 10px;
                    margin: 5px;
                    margin-top: 10px;
                    border-radius: 10px;
                    line-height: inherit;
                    align-items: center;
                    font-size: 18px;
                    color: white;
                    background-color: var(--shipcard-header-color);
                    display: flex;
                    flex-direction: row;
                    justify-content: stretch;
                }

                .shipcard-validated {
                    border-left: 10px solid #7CFC00;
                }

                .shipcard-not-validated {
                    border-left: 10px solid lightgrey;
                }

                .shipcard-dubious {
                    border-left: 10px solid red;
                }

                .shipcard-not-validated-transparant {
                    border-left: 10px solid transparent;
                }

                .shipcard-footer {
                    background-color: var(--shipcard-footer-background-color);
                    border-bottom: 1px solid var(--shipcard-footer-shadow-color);
                    flex: 0 0 50px;
                    border-radius: 10px;
                    display: flex;
                    flex-direction: row;
                    margin: 5px;
                    margin-bottom: 10px;
                    justify-content: center;
                }

                    .shipcard-footer > div {
                        flex: 0 1 100px;
                        display: flex;
                        flex-direction: column;
                        border-radius: 10px;
                        transition: var( --hover-transition);
                    }

                @media (hover: hover) {

                    .shipcard-footer > div:hover {
                        cursor: pointer;
                        background: var(--hover-background);
                        transform: var(--hover-transform);
                    }
                }

                .shipcard-footer > div > i {
                    flex: 1;
                    color: white;
                    font-size: 2px;
                    margin: auto;
                    padding: 10px;
                }

                .shipcard-footer > div > span {
                    flex: 1;
                    font-size: 9px;
                    line-height: 3px;
                    color: white;
                    text-align: center;
                }

                #shipcard header > span:first-child {
                    flex: 1 0 0;
                }

                .shipcard-header-icon {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex: 0 1 0;
                    padding: 0px;
                    border-radius: 10px;
                    font-size: 24px;
                    transition: var(--hover-transition);
                }

                @media (hover: hover) {

                    .shipcard-header-icon:hover {
                        cursor: pointer;
                        background: var(--hover-background);
                        transform: var(--hover-transform);
                    }
                }

                #shipcard_content {
                    display: flex;
                    flex-direction: column;
                }

                .shipcard-content-row {
                    display: flex;
                    flex-direction: row;
                    justify-content: stretch;
                    padding: 10px;
                    border-bottom: 1px solid var(--shipcard-divider-color);
                    transition: var( --hover-transition);
                }

                    .shipcard-content-row:hover {
                        cursor: pointer;
                    }

                    .shipcard-content-row > div {
                        overflow: hidden;
                        flex: 1;
                        display: flex;
                        justify-content: stretch;
                        flex-direction: column;
                    }

                        .shipcard-content-row > div > span:first-child {
                            color: rgb(111, 128, 124);
                            text-transform: uppercase;
                            font-size: 10px;
                            line-height: 14px;
                        }

                        .shipcard-content-row > div > span:last-child {
                            line-height: 20px;
                            font-size: 14px;
                            text-transform: initial;
                        }

                            .shipcard-content-row > div > span:last-child:empty:after {
                                content: "-";
                            }

                .shipcard-min-only {
                    display: none;
                }

                    .shipcard-min-only.visible {
                        display: inherit;
                    }

                .shipcard-max-only.hide {
                    display: none;
                }

                .shipcard-row-selected {
                    background-color: var(--shipcard-selection-color);
                    display: flex;
                    flex-direction: row;
                }

                @media only screen and (max-width:500px) {
                    #shipcard {
                        width: 100%;
                        left: 0;
                        top: 0;
                        border-radius: 0px;
                    }

                        #shipcard header {
                            font-size: 14px;
                        }
                }

                @media only screen and (max-height:800px) {
                    .shipcard-ismax {
                        height: 100%
                    }

                    #shipcard {
                        left: 0;
                        top: 0;
                        border-radius: 0px;
                    }

                        #shipcard header {
                            font-size: 14px;
                        }
                }

                .pulse {
                    animation: pulsate 1s ease-out;
                    animation-iteration-count: infinite;
                    -webkit-animation: pulsate 1s ease-out;
                    -webkit-animation-iteration-count: infinite;
                    opacity: 0.25;
                }

                @keyframes pulsate {
                    0% {
                        transform: opacity 0.25;
                    }

                    50% {
                        opacity: 1.0;
                    }

                    100% {
                        transform: opacity 0.25;
                    }
                }


                .leaflet-control-layers-toggle,
                .leaflet-control-settings-toggle {
                    font-size: 18px;
                    min-width: 30px;
                    min-height: 30px;
                    max-width: 30px;
                    max-height: 30px;
                }

                .leaflet-container .leaflet-control-attribution,
                .leaflet-control-scale-line,
                .leaflet-control-layers-toggle,
                .leaflet-control-settings-toggle,
                .leaflet-control-layers,
                .leaflet-bar a.leaflet-disabled,
                .leaflet-control-zoom a {
                    background-color: var(--leaflet-control-color);
                    color: var(--menu-font-color);
                }

                .leaflet-control-settings-toggle {
                    text-align: center;
                    color: var(--menu-font-color);
                    transform: translate(200px 0)
                }

                    .leaflet-control-layers-toggle:hover,
                    .leaflet-control-settings-toggle:hover,
                    .leaflet-control-layers:hover,
                    .leaflet-control-zoom a:hover {
                        background-color: var(--menu-background-color);
                    }

                @media (hover: hover) {
                    .leaflet-control-layers-toggle:hover,
                    .leaflet-control-settings-toggle:hover,
                    .leaflet-control-layers:hover,
                    .leaflet-control-zoom a:hover {
                        background-color: var(--menu-background-hover-color);
                    }
                }

                /* Summary tab */
                .stat-tab {
                    padding: 15px;
                    display: grid;
                    grid-template-columns: repeat(4, minmax(0, 1fr));
                    column-gap: 15px;
                    row-gap: 15px;
                    max-width: 3000px;
                    margin: 0 auto;
                    justify-content: center;
                }

                @media only screen and (max-width:2250px) {
                    .stat-tab {
                        grid-template-columns: repeat(3, minmax(0, 1fr));
                        padding: 5px;
                    }
                }

                @media only screen and (max-width:1500px) {
                    .stat-tab {
                        grid-template-columns: repeat(2, minmax(0, 1fr));
                        padding: 5px;
                    }
                }

                @media only screen and (max-width:750px) {
                    .stat-tab {
                        grid-template-columns: repeat(1, minmax(0, 1fr));
                        padding: 0px;
                    }
                }
                /*
                    .stat-tab {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                    }
        */
                .stat-panel {
                    max-width: 750px;
                    width: 100%;
                    border-radius: 15px;
                    background-color: var(--panel-color);
                }

                    .stat-panel > header {
                        margin: 20px auto 30px auto;
                        padding: 5px 0px;
                        border-radius: 10px;
                        max-width: 400px;
                        width: calc(100% - 30px);
                        align-items: center;
                        border-left: 10px solid var(--graph-header-side-color);
                        border-right: 10px solid var(--graph-header-side-color);
                        background-color: var(--graph-header-bg-color);
                        color: var(--graph-header-color);
                        text-align: center;
                        font-size: 1.0em;
                    }


                    .stat-panel section {
                        margin-bottom: 10px;
                        padding: 10px;
                        margin: 0 auto;
                    }

                        .stat-panel section div {
                            display: flex;
                        }

                            .stat-panel section div span:first-child {
                                flex: 1 1 150px;
                                text-align: right;
                                color: var(--stat-label-color);
                                padding: 5px 20px 5px 20px;
                                display: flex;
                                flex-direction: column
                            }

                            .stat-panel section div span:last-child {
                                flex: 1 0 150px;
                                text-align: left;
                                color: var(--stat-color);
                                padding: 5px 20px 5px 20px;
                                font-weight: 550;
                                overflow-x: auto;
                                white-space: nowrap;
                                border-left: solid 1px var(--stat-divider-color);
                            }

                                .stat-panel section div span:last-child:empty:after {
                                    content: "-";
                                }

                .flag-icon {
                    margin-right: 10px;
                }

                .leaflet-tooltip .flag-icon {
                    font-size: 12px;
                    vertical-align: middle;
                    margin-right: 5px;
                }

                .leaflet-tooltip {
                    background-color: var(--tooltip-background-color) !important;
                    color: var(--menu-font-color) !important;
                    border-color: var(--tooltip-border-color);
                }

                    .leaflet-tooltip:before {
                        border-color: transparent var(--tooltip-background-color) transparent transparent;
                    }

                .leaflet-tooltiplabel {
                    background-color: transparent !important;
                    color: var(--menu-font-color);
                    border: none;
                    box-shadow: none;
                    font-size: 10px;
                    padding: 3px;
                }

                    .leaflet-tooltiplabel span:nth-child(1),
                    .leaflet-tooltiplabel span:nth-child(3) {
                        display: none;
                    }

                    .leaflet-tooltiplabel:before {
                        display: none;
                    }

                @media only screen and (max-width:750px) {
                    .leaflet-tooltip, .leaflet-tooltiplabel {
                        font-size: 8px;
                        padding: 3px;
                    }

                        .leaflet-tooltip .flag-icon {
                            font-size: 8px;
                        }
                }

                .blue {
                    color: #12a5ed;
                }

                .green {
                    color: green;
                }

                .red {
                    color: red;
                }

                .grey {
                    color: dimgray;
                }

                .lightgrey {
                    color: lightgrey;
                }

                #context-menu {
                    position: absolute;
                    display: none;
                    background-color: var(--menu-background-color);
                    border: 1px solid var(--menu-border-color);
                    border-radius: 5px;
                    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
                    list-style-type: none;
                    padding: 8px 0;
                    z-index: 10002;
                    font-size: 14px;
                    color: var(--menu-font-color);
                    width: auto;
                    margin: 0;
                }

                    #context-menu li {
                        display: flex;
                        align-items: center;
                        height: 24px;
                        margin: auto;
                        padding: 0 16px;
                        cursor: pointer;
                        white-space: nowrap; /* Prevent wrapping */
                    }

                    #context-menu .divider {
                        height: 1px;
                        background-color: var(--menu-divider-color);
                        margin: 0.5rem 0;
                        pointer-events: none;
                    }

                    #context-menu li:hover {
                        background-color: var(--menu-background-hover-color);
                    }

                    #context-menu i {
                        margin-right: 8px;
                        font-size: 16px;
                        width: 16px;
                    }

                    #context-menu .dynamic-item {
                        color: #666;
                    }

                        #context-menu .dynamic-item:hover {
                            background-color: transparent;
                        }

                .marker {
                    display: inline;
                    margin-left: 16px;
                    color: var(--menu-marker-color);
                }

                .selected-setting .marker {
                    display: inline;
                }

                .hidden {
                    display: none;
                }

                #dialog-box {
                    position: fixed;
                    max-height: 80vh;
                    max-width: 80vw;
                    background-color: var(--menu-background-color);
                    color: var(--menu-font-color);
                    border: 1px solid #ccc;
                    border-radius: 15px;
                    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
                    left: 50%;
                    top: 50%;
                    transform: translate(-50%, -50%);
                    z-index: 10001;
                }

                .dialog-title {
                    padding: 15px;
                    border-top-left-radius: 15px;
                    border-top-right-radius: 15px;
                    font-size: 18px;
                    font-weight: bold;
                    margin-bottom: 10px;
                    color: white;
                    background-color: var(--dialog-title-color);
                }

                .dialog-message {
                    padding: 0px 15px;
                    font-size: 14px;
                    user-select: text;
                    margin-bottom: 20px;
                    max-height: 60vh;
                    overflow-y: auto;
                    box-sizing: border-box;
                }

                .dialog-close {
                    padding: 10px 40px;
                    background-color: var(--menu-background-hover-color);
                    border: none;
                    color: var(--menu-font-color);
                    /*padding: 8px 16px;*/
                    text-align: center;
                    text-decoration: none;
                    display: inline-block;
                    font-size: 14px;
                    margin: 0px 15px 15px 15px;
                    cursor: pointer;
                    border-radius: 10px;
                }

                .stationIcon {
                    position: relative;
                    display: inline-block;
                }

                    .stationIcon i {
                        color: var(--secondary-color);
                        font-size: 18px;
                    }

                    .stationIcon div {
                        position: absolute;
                        top: -2px;
                        left: -3px;
                        width: 24px;
                        height: 24px;
                        background-color: var(--tertiary-color);
                        border-radius: 50%;
                        z-index: -1;
                    }

                .ownShipIcon {
                    position: relative;
                    display: inline-block;
                }

                    .ownShipIcon i {
                        color: var(--secondary-color);
                        font-size: 18px;
                    }

                    .ownShipIcon div {
                        position: absolute;
                        top: -11px;
                        left: -12px;
                        width: 40px;
                        height: 40px;
                        background-color: var(--stationCircleColor);
                        border-radius: 50%;
                        opacity: 75%;
                        z-index: -1;
                    }

                .feed_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M180-120q-24 0-42-18t-18-42v-600q0-24 18-42t42-18h462l198 198v462q0 24-18 42t-42 18H180Zm99-171h402v-60H279v60Zm0-159h402v-60H279v60Zm330-159h171L609-780v171Zm-330 0h201v-60H279v60Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .business_center_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M140-120q-24 0-42-18t-18-42v-191h311v60h180v-60h309v191q0 24-18 42t-42 18H140Zm311-251v-60h60v60h-60ZM80-431v-229q0-24 18-42t42-18h180v-100q0-24 18-42t42-18h200q24 0 42 18t18 42v100h180q24 0 42 18t18 42v229H571v-60H391v60H80Zm300-289h200v-100H380v100Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .cloud_download_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M251-160q-88 0-149.5-61.5T40-371q0-78 50-137t127-71q18-90 83-150t151-68v349l-83-83-43 43 156 156 156-156-43-43-83 83v-349q101 11 169 90t68 185v24q72-2 122 46.5T920-329q0 69-50 119t-119 50H251Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .view_list_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M350-160h470q24.75 0 42.375-17.625T880-220v-114H350v174ZM80-626h210v-174H140q-24.75 0-42.375 17.625T80-740v114Zm0 233h210v-173H80v173Zm60 233h150v-174H80v114q0 24.75 17.625 42.375T140-160Zm210-233h530v-173H350v173Zm0-233h530v-114q0-24.75-17.625-42.375T820-800H350v174Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .map_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="m612-120-263-93-179 71q-17 9-33.5-1T120-173v-558q0-13 7.5-23t19.5-15l202-71 263 92 178-71q17-8 33.5 1.5T840-788v565q0 11-7.5 19T814-192l-202 72Zm-34-75v-505l-196-66v505l196 66Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .info_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M453-280h60v-240h-60v240Zm26.982-314q14.018 0 23.518-9.2T513-626q0-14.45-9.482-24.225-9.483-9.775-23.5-9.775-14.018 0-23.518 9.775T447-626q0 13.6 9.482 22.8 9.483 9.2 23.5 9.2Zm.284 514q-82.734 0-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681 80-480.5q0-82.819 31.5-155.659Q143-709 197.5-763t127.341-85.5Q397.681-880 480.5-880q82.819 0 155.659 31.5Q709-817 763-763t85.5 127Q880-563 880-480.266q0 82.734-31.5 155.5T763-197.684q-54 54.316-127 86Q563-80 480.266-80Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .help_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M484-247q16 0 27-11t11-27q0-16-11-27t-27-11q-16 0-27 11t-11 27q0 16 11 27t27 11Zm-35-146h59q0-26 6.5-47.5T555-490q31-26 44-51t13-55q0-53-34.5-85T486-713q-49 0-86.5 24.5T345-621l53 20q11-28 33-43.5t52-15.5q34 0 55 18.5t21 47.5q0 22-13 41.5T508-512q-30 26-44.5 51.5T449-393Zm31 313q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 31.5-156t86-127Q252-817 325-848.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 82-31.5 155T763-197.5q-54 54.5-127 86T480-80Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .leaderboard_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M80-120v-480h200v480H80Zm300 0v-720h200v720H380Zm300 0v-400h200v400H680Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .settings_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="m388-80-20-126q-19-7-40-19t-37-25l-118 54-93-164 108-79q-2-9-2.5-20.5T185-480q0-9 .5-20.5T188-521L80-600l93-164 118 54q16-13 37-25t40-18l20-127h184l20 126q19 7 40.5 18.5T669-710l118-54 93 164-108 77q2 10 2.5 21.5t.5 21.5q0 10-.5 21t-2.5 21l108 78-93 164-118-54q-16 13-36.5 25.5T592-206L572-80H388Zm92-270q54 0 92-38t38-92q0-54-38-92t-92-38q-54 0-92 38t-38 92q0 54 38 92t92 38Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .fullscreen_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M200-200v-193h60v133h133v60H200Zm0-367v-193h193v60H260v133h-60Zm367 367v-60h133v-133h60v193H567Zm133-367v-133H567v-60h193v193h-60Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .link_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M450-280H280q-83 0-141.5-58.5T80-480q0-83 58.5-141.5T280-680h170v60H280q-58.333 0-99.167 40.765-40.833 40.764-40.833 99Q140-422 180.833-381q40.834 41 99.167 41h170v60ZM325-450v-60h310v60H325Zm185 170v-60h170q58.333 0 99.167-40.765 40.833-40.764 40.833-99Q820-538 779.167-579 738.333-620 680-620H510v-60h170q83 0 141.5 58.5T880-480q0 83-58.5 141.5T680-280H510Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .more_vert_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M479.858-160Q460-160 446-174.142q-14-14.141-14-34Q432-228 446.142-242q14.141-14 34-14Q500-256 514-241.858q14 14.141 14 34Q528-188 513.858-174q-14.141 14-34 14Zm0-272Q460-432 446-446.142q-14-14.141-14-34Q432-500 446.142-514q14.141-14 34-14Q500-528 514-513.858q14 14.141 14 34Q528-460 513.858-446q-14.141 14-34 14Zm0-272Q460-704 446-718.142q-14-14.141-14-34Q432-772 446.142-786q14.141-14 34-14Q500-800 514-785.858q14 14.141 14 34Q528-732 513.858-718q-14.141 14-34 14Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .add_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M450-450H200v-60h250v-250h60v250h250v60H510v250h-60v-250Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .close_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="m249-207-42-42 231-231-231-231 42-42 231 231 231-231 42 42-231 231 231 231-42 42-231-231-231 231Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .push_pin_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="m634-448 86 77v60H510v241l-30 30-30-30v-241H240v-60l80-77v-333h-50v-60h414v60h-50v333Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .content_copy_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M180-81q-24 0-42-18t-18-42v-603h60v603h474v60H180Zm120-120q-24 0-42-18t-18-42v-560q0-24 18-42t42-18h440q24 0 42 18t18 42v560q0 24-18 42t-42 18H300Zm0-60h440v-560H300v560Zm0 0v-560 560Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .undo_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M259-200v-60h310q70 0 120.5-46.5T740-422q0-69-50.5-115.5T569-584H274l114 114-42 42-186-186 186-186 42 42-114 114h294q95 0 163.5 64T800-422q0 94-68.5 158T568-200H259Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .remove_circle_outline_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M280-453h400v-60H280v60ZM480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 31.5-156t86-127Q252-817 325-848.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 82-31.5 155T763-197.5q-54 54.5-127 86T480-80Zm0-60q142 0 241-99.5T820-480q0-142-99-241t-241-99q-141 0-240.5 99T140-480q0 141 99.5 240.5T480-140Zm0-340Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .label_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M840-480 671-241q-13 18-31 29.5T600-200H180q-24.75 0-42.375-17.625T120-260v-440q0-24.75 17.625-42.375T180-760h420q22 0 40 11.5t31 29.5l169 239Zm-75 0L611-700H180v440h431l154-220Zm-585 0v220-440 220Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .signal_cellular_alt_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M185-160v-117h127v117H185Zm253 0v-379h126v379H438Zm252 0v-640h126v640H690Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .timeline_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M109.912-240Q81-240 60.5-260.589 40-281.177 40-310.089 40-339 60.494-359.5t49.273-20.5q5.233 0 10.233.5 5 .5 13 2.5l200-200q-2-8-2.5-13t-.5-10.233q0-28.779 20.589-49.273Q371.177-670 400.089-670 429-670 449.5-649.366t20.5 49.61Q470-598 467-577l110 110q8-2 13-2.5t10-.5q5 0 10 .5t13 2.5l160-160q-2-8-2.5-13t-.5-10.233q0-28.779 20.589-49.273Q821.177-720 850.089-720 879-720 899.5-699.411q20.5 20.588 20.5 49.5Q920-621 899.506-600.5T850.233-580Q845-580 840-580.5q-5-.5-13-2.5L667-423q2 8 2.5 13t.5 10.233q0 28.779-20.589 49.273Q628.823-330 599.911-330 571-330 550.5-350.494T530-399.767q0-5.233.5-10.233.5-5 2.5-13L423-533q-8 2-13 2.5t-10.25.5q-1.75 0-22.75-3L177-333q2 8 2.5 13t.5 10.233q0 28.779-20.589 49.273Q138.823-240 109.912-240Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .zoom_in_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M796-121 533-384q-30 26-69.959 40.5T378-329q-108.162 0-183.081-75Q120-479 120-585t75-181q75-75 181.5-75t181 75Q632-691 632-584.85 632-542 618-502q-14 40-42 75l264 262-44 44ZM377-389q81.25 0 138.125-57.5T572-585q0-81-56.875-138.5T377-781q-82.083 0-139.542 57.5Q180-666 180-585t57.458 138.5Q294.917-389 377-389Zm-31-85v-82h-82v-60h82v-81h60v81h81v60h-81v82h-60Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .menu_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M120-240v-60h720v60H120Zm0-210v-60h720v60H120Zm0-210v-60h720v60H120Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .directions_boat_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M156-200 82-457q-4-12 1.5-23.5T101-496l59-20v-224q0-25 17.5-42t42.5-18h150v-120h220v120h150q25 0 42.5 17.5T800-740v225l60 19q11 4 16.5 15t1.5 23l-74 258q-48-5-89.5-29T641-286q-32 36-72.5 61T480-200q-48 0-88.5-25T319-286q-32 33-73.5 57T156-200ZM80-40v-60h80q42 0 83-13t77-37q36 24 77 36t83 12q42 0 83-12t77-36q36 24 77 37t83 13h80v60h-80q-41 0-81-10.5T640-81q-39 20-80 30.5T480-40q-39 0-80-10.5T320-81q-39 20-79 30.5T160-40H80Zm140-495 260-84 260 85v-206H220v205Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .dns_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M286.882-717Q266-717 251.5-702.382q-14.5 14.617-14.5 35.5Q237-646 251.618-631.5q14.617 14.5 35.5 14.5Q308-617 322.5-631.618q14.5-14.617 14.5-35.5Q337-688 322.382-702.5q-14.617-14.5-35.5-14.5Zm0 414Q266-303 251.5-288.382q-14.5 14.617-14.5 35.5Q237-232 251.618-217.5q14.617 14.5 35.5 14.5Q308-203 322.5-217.618q14.5-14.617 14.5-35.5Q337-274 322.382-288.5q-14.617-14.5-35.5-14.5ZM154-839h651q16 0 25.5 9.5t9.5 25.813V-535q0 17.425-9.5 29.212Q821-494 805-494H154q-15 0-24.5-11.788Q120-517.575 120-535v-268.687q0-16.313 9.5-25.813T154-839Zm26 60v225h600v-225H180Zm-26 353h647q15 0 27 12.5t12 28.527V-121q0 20-12 30.5T801-80H159q-16 0-27.5-10.5T120-121v-263.973q0-16.027 9.5-28.527T154-426Zm26 60v226h600v-226H180Zm0-413v225-225Zm0 413v226-226Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .mail_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M140-160q-24 0-42-18t-18-42v-520q0-24 18-42t42-18h680q24 0 42 18t18 42v520q0 24-18 42t-42 18H140Zm340-302L140-685v465h680v-465L480-462Zm0-60 336-218H145l335 218ZM140-685v-55 520-465Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }

                .content_paste_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M180-120q-26 0-43-17t-17-43v-600q0-26 17-43t43-17h202q7-35 34.5-57.5T480-920q36 0 63.5 22.5T578-840h202q26 0 43 17t17 43v600q0 26-17 43t-43 17H180Zm0-60h600v-600h-60v90H240v-90h-60v600Zm300-600q17 0 28.5-11.5T520-820q0-17-11.5-28.5T480-860q-17 0-28.5 11.5T440-820q0 17 11.5 28.5T480-780Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .search_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M796-121 533-384q-30 26-69.959 40.5T378-329q-108.162 0-183.081-75Q120-479 120-585t75-181q75-75 181.5-75t181 75Q632-691 632-584.85 632-542 618-502q-14 40-42 75l264 262-44 44ZM377-389q81.25 0 138.125-57.5T572-585q0-81-56.875-138.5T377-781q-82.083 0-139.542 57.5Q180-666 180-585t57.458 138.5Q294.917-389 377-389Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .public_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm-43-61v-82q-35 0-59-26t-24-61v-44L149-559q-5 20-7 39.5t-2 39.5q0 130 84.5 227T437-141Zm294-108q22-24 38.5-51t28-56.5q11.5-29.5 17-60.5t5.5-63q0-106-58-192.5T607-799v18q0 35-24 61t-59 26h-87v87q0 17-13.5 28T393-568h-83v88h258q17 0 28 13t11 30v127h43q29 0 51 17t30 44Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }



                .build_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M705-128 447-388q-23 8-46 13t-47 5q-97 0-165-67.5T121-602q0-31 8-60.5t23-55.5l145 145 92-86-149-149q26-15 55-23.5t59-8.5q99 0 168.5 69.5T592-602q0 24-5 47t-13 46l259 258q11 11 11 26.5T833-198l-76 70q-11 11-26 11t-26-11Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .brightness_4_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M481-29 346-160H160v-186L26-480l134-134v-186h186l135-134 133 134h186v186l134 134-134 134v186H614L481-29Zm-2-191q111 0 186-75.5T740-481q0-110-75.5-185.5T479-742q-27 0-52 5.5T373-718q69 32 111 96t42 141q0 77-42 141t-111 97q24 11 50.5 17t55.5 6Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .keyboard_arrow_down_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M480-344 240-584l43-43 197 197 197-197 43 43-240 240Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .keyboard_arrow_up_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M480-554 283-357l-43-43 240-240 240 240-43 43-197-197Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .more_horiz_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"%3E%3Cpath d="M0 0h24v24H0V0z" fill="none"/%3E%3Cpath d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .cell_tower_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                    background-color: currentColor;
                    --svg: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"%3E%3Cpath d="M198-278q-60-58-89-133T80-560q0-74 29-149t89-133l35 35q-50 49-76.5 116.5T130-560q0 63 26.5 130.5T233-313l-35 35Zm92-92q-40-37-59-89.5T212-560q0-48 19-100.5t59-89.5l35 35q-29 29-46 72.5T262-560q0 35 17.5 79.5T325-405l-35 35Zm4 290 133-405q-17-12-27.5-31T389-560q0-38 26.5-64.5T480-651q38 0 64.5 26.5T571-560q0 25-10.5 44T533-485L666-80h-59l-29-90H383l-30 90h-59Zm108-150h156l-78-238-78 238Zm268-140-35-35q29-29 46-72.5t17-82.5q0-35-17.5-79.5T635-715l35-35q39 37 58.5 89.5T748-560q0 47-19.5 100T670-370Zm92 92-35-35q49-49 76-116.5T830-560q0-63-27-130.5T727-807l35-35q60 58 89 133t29 149q0 75-27.5 149.5T762-278Z"/%3E%3C/svg%3E');
                    -webkit-mask-image: var(--svg);
                    mask-image: var(--svg);
                    -webkit-mask-repeat: no-repeat;
                    mask-repeat: no-repeat;
                    -webkit-mask-size: 100% 100%;
                    mask-size: 100% 100%;
                }


                .empty_icon {
                    display: block;
                    width: 1em;
                    height: 1em;
                }

                .showflex {
                    display: flex;
                }

                .hide {
                    display: none;
                }
    </style>

    <link rel="stylesheet" href="config.css">
</head>

<body>

    <div class="header noandroid">
        <div onclick="toggleMenu()" class="header-menubutton"><div class="header-menu-box"><i id="header_menu_button" class="menu_icon"></i></div></div>
        <div class="header-title">
            <span onclick="headerClick()">AIS-catcher</span>

            <div id="menubar_mini" class="showflex">
                <i id="stat_tab_mini" onclick="activateTab(event,'stat')" class="business_center_icon"></i>
                <i id="plots_tab_mini" onclick="activateTab(event,'plots')" class="leaderboard_icon"></i>
                <i id="ships_tab_mini" onclick="activateTab(event,'ships')" class="view_list_icon"></i>
                <i id="map_tab_mini" onclick="activateTab(event,'map')" class="map_icon"></i>
                <i id="realtime_tab_mini" onclick="activateTab(event,'realtime')" class="feed_icon"></i>
                <i id="about_tab_mini" onclick="activateTab(event,'about')" class="info_icon"></i>
            </div>
        </div>

        <div title="About" onclick="showAboutDialog()" class="header-icon">
            <i class="help_icon small-icon"></i>
        </div>

        <div title="Settings" onclick="showContextMenu(event, '', ['settings', 'center'])" class="header-icon">
            <i class="settings_icon small-icon"></i>
        </div>

        <div title="Toggle full screen mode" onclick="toggleScreenSize()" class="header-icon">
            <i id="screentoggle-id" class="fullscreen_icon" small-icon></i>
        </div>

        <div title="Connection status with server" id="pulse-id" class="header-pulse-ok">
            <i class="link_icon small-icon"></i>
        </div>

    </div>
    <nav id="menubar">
        <div onclick="activateTab(event,'stat')" id="stat_tab">
            <i class="business_center_icon"></i><span>Summary</span>
        </div>

        <div onclick="activateTab(event,'plots')" id="plots_tab">
            <i class="leaderboard_icon"></i><span>Plots</span>
        </div>

        <div onclick="activateTab(event,'ships')" id="ships_tab">
            <i class="view_list_icon"></i><span>Ships</span>
        </div>

        <div onclick="activateTab(event,'map')" id="map_tab">
            <i class="map_icon"></i><span>Map</span>
        </div>

        <div onclick="activateTab(event,'realtime')" id="realtime_tab">
            <i class="feed_icon"></i><span>Realtime</span>
        </div>

        <div onclick="activateTab(event,'about')" id="about_tab">
            <i class="info_icon"></i><span>About</span>
        </div>
    </nav>

    <div class="mainspace-container">
        <div oncontextmenu="showContextMenu(event,0,['settings'])" class="mainspace">

            <ul id="context-menu">
                <li class="station" onclick="pinStation()"><i class="push_pin_icon"></i>Center map on station</li>
                <li class="divider station"></li>
                <li class="copy-text" onclick="copyText(context_mmsi)"><i class="content_copy_icon"></i>Copy to Clipboard</li>
                <li class="divider copy-text"></li>
                <li class="table-menu" onclick="downloadCSV()"><i class="cloud_download_icon"></i>Download CSV</li>
                <li class="divider table-menu"></li>
                <li class="ctx-map" onclick="unpinCenter()" id="ctx_menu_unpin"><i class="undo_icon"></i><span id="ctx_unpin">Release map center</span></li>
                <li class="ctx-map" onclick="deleteAllTracks()"><i class="remove_circle_outline_icon"></i>Remove all tracks</li>
                <li class="ctx-map" onclick="toggleLabel()"><i class="label_icon"></i><span id="ctx_labelswitch"></span></li>
                <li class="ctx-map" onclick="toggleTooltipStyling()"><i class="label_icon"></i><span id="ctx_tooltipstyling"></span></li>
                <li class="ctx-map" onclick="toggleTooltipOverlap()"><i class="label_icon"></i><span id="ctx_tooltipoverlap"></span></li>
                <li class="divider ctx-map"></li>
                <li class="ctx-map" onclick="toggleFading()"><i class="directions_boat_icon"></i><span id="ctx_fading"></span></li>
                <li class="ctx-map" onclick="toggleRange()"><i class="signal_cellular_alt_icon"></i><span id="ctx_range"></span></li>
                <li class="divider ctx-map"></li>
                <li class="mmsi-map" onclick="toggleTrack(context_mmsi)"><i class="timeline_icon"></i><span id="ctx_track"></span></li>
                <li class="mmsi-map" onclick="pinVessel(context_mmsi)"><i class="push_pin_icon"></i>Center map on vessel</li>
                <li class="mmsi-map" onclick="mapResetView(13,context_mmsi)"><i class="zoom_in_icon"></i>Zoom in on vessel</li>
                <li class="mmsi-map" onclick="showShipcard(context_mmsi)"><i class="directions_boat_icon"></i>Show Shipcard</li>
                <li class="divider mmsi-map"></li>
                <li class="mmsi" onclick="showVesselDetail(context_mmsi)"><i class="dns_icon"></i>Show Vessel Database Entry</li>
                <li class="mmsi noandroid" onclick="showNMEA(context_mmsi)"><i class="mail_icon"></i>Show Last Message</li>
                <li class="mmsi" onclick="copyText(context_mmsi)"><i class="content_copy_icon"></i>Copy MMSI</li>
                <li class="mmsi" onclick="copyCoordinates(context_mmsi)"><i class="content_paste_icon"></i>Copy Coordinates</li>
                <li class="divider mmsi"></li>
                <li class="mmsi noandroid" onclick="openGoogleSearch(context_mmsi)"><i class="search_icon"></i>Search on Google</li>
                <li class="mmsi noandroid" onclick="openMarineTraffic(context_mmsi)"><i class="public_icon"></i>Find on MarineTraffic</li>
                <li class="mmsi noandroid" onclick="openVesselFinder(context_mmsi)"><i class="public_icon"></i>Find on VesselFinder</li>
                <li class="mmsi noandroid" onclick="openAISHub(context_mmsi)"><i class="public_icon"></i>Find on AISHub</li>
                <li class="mmsi noandroid" onclick="openShipXplorer(context_mmsi)"><i class="public_icon"></i>Find on ShipXplorer</li>
                <li class="divider mmsi noandroid"></li>
                <li class="settings" onclick="showPlugins()"><i class="build_icon"></i>Installed Plugins...</li>
                <li class="settings noandroid" onclick="toggleDarkMode()"><i class="brightness_4_icon"></i>Toggle Light/Dark mode</li>
            </ul>

            <div id="dialog-box" class="hidden">
                <div class="dialog-title">Dialog Title</div>
                <div class="dialog-message">This is the message area.</div>
                <button class="dialog-close" onclick="closeDialog()">Close</button>
            </div>

            <div class="tabcontent addscrollbar" id="about">
                <div class="aboutpage" id="about_content"></div>
            </div>

            <div class="tabcontent addscrollbar" id="realtime">
                <pre id="realtime_content"></pre>
            </div>

            <div class="tabcontent addscrollbar" id="stat">
                <div class="stat-tab">
                    <div class="stat-panel">
                        <header>System</header>
                        <section class="noandroid">
                            <div>
                                <span>Station</span><span id="stat_station"></span>
                            </div>
                        </section>
                        <section class="noandroid">
                            <div>
                                <span>OS</span><span id="stat_os"></span>
                            </div>
                            <div>
                                <span>Hardware</span><span id="stat_hardware"></span>
                            </div>
                            <div>
                                <span>Device</span><span id="stat_product"></span>
                            </div>
                            <div>
                                <span>Vendor</span><span id="stat_vendor"></span>
                            </div>
                            <div>
                                <span>Serial</span><span id="stat_serial"></span>
                            </div>
                        </section>
                        <section class="noandroid">
                            <div>
                                <span>Version</span><span id="stat_build_describe"></span>
                            </div>
                            <div>
                                <span>Build date</span><span id="stat_build_date"></span>
                            </div>
                            <div>
                                <span>Engine</span><span id="stat_model"></span>
                            </div>
                            <div>
                                <span>Memory</span><span id="stat_memory"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Device rate</span><span id="stat_sample_rate"></span>
                            </div>
                            <div>
                                <span>Data processed</span><span id="stat_received"></span>
                            </div>
                            <div>
                                <span>Running time</span><span id="stat_run_time"></span>
                            </div>
                            <div>
                                <span>Message rate</span><span id="stat_msg_rate"></span>
                            </div>
                        </section>
                    </div>

                    <div class="stat-panel">

                        <header>This Session</header>

                        <section>
                            <div>
                                <span>Total messages</span><span id="stat_session_count"></span>
                            </div>
                            <div>
                                <span>Vessels seen</span><span id="stat_session_vessel_count"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Channel A</span><span id="stat_session_channel0"></span>
                            </div>
                            <div>
                                <span>Channel B</span><span id="stat_session_channel1"></span>
                            </div>
                            <div>
                                <span>Channel C</span><span id="stat_session_channel2"></span>
                            </div>
                            <div>
                                <span>Channel D</span><span id="stat_session_channel3"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Class A position</span><span id="stat_session_msg123"></span>
                            </div>
                            <div>
                                <span>Class A static</span><span id="stat_session_msg5"></span>
                            </div>
                            <div>
                                <span>Class B position</span><span id="stat_session_msg1819"></span>
                            </div>
                            <div>
                                <span>Class B static</span><span id="stat_session_msg24"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Base station</span><span id="stat_session_msg4"></span>
                            </div>
                            <div>
                                <span>SAR aircraft</span><span id="stat_session_msg9"></span>
                            </div>
                            <div>
                                <span>Aid-to-Navigation</span><span id="stat_session_msg21"></span>
                            </div>
                            <div>
                                <span>Other</span><span id="stat_session_msgother"></span>
                            </div>
                        </section>
                    </div>


                    <div class="stat-panel">

                        <header>Total Messages</header>

                        <section>
                            <div>
                                <span>Total messages</span><span id="stat_total_count"></span>
                            </div>
                            <div>
                                <span>Vessels seen</span><span id="stat_total_vessel_count"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Channel A</span><span id="stat_total_channel0"></span>
                            </div>
                            <div>
                                <span>Channel B</span><span id="stat_total_channel1"></span>
                            </div>
                            <div>
                                <span>Channel C</span><span id="stat_total_channel2"></span>
                            </div>
                            <div>
                                <span>Channel D</span><span id="stat_total_channel3"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Class A position</span><span id="stat_total_msg123"></span>
                            </div>
                            <div>
                                <span>Class A static</span><span id="stat_total_msg5"></span>
                            </div>
                            <div>
                                <span>Class B position</span><span id="stat_total_msg1819"></span>
                            </div>
                            <div>
                                <span>Class B static</span><span id="stat_total_msg24"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Base station</span><span id="stat_total_msg4"></span>
                            </div>
                            <div>
                                <span>SAR aircraft</span><span id="stat_total_msg9"></span>
                            </div>
                            <div>
                                <span>Aid-to-Navigation</span><span id="stat_total_msg21"></span>
                            </div>
                            <div>
                                <span>Other</span><span id="stat_total_msgother"></span>
                            </div>
                        </section>

                    </div>


                    <div class="stat-panel">

                        <header>Previous Minute</header>


                        <section>
                            <div>
                                <span>Total messages</span><span id="stat_last_minute_count"></span>
                            </div>
                            <div>
                                <span>Vessels seen</span><span id="stat_last_minute_vessel_count"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Channel A</span><span id="stat_last_minute_channel0"></span>
                            </div>
                            <div>
                                <span>Channel B</span><span id="stat_last_minute_channel1"></span>
                            </div>
                            <div>
                                <span>Channel C</span><span id="stat_last_minute_channel2"></span>
                            </div>
                            <div>
                                <span>Channel D</span><span id="stat_last_minute_channel3"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Class A position</span><span id="stat_last_minute_msg123"></span>
                            </div>
                            <div>
                                <span>Class A static</span><span id="stat_last_minute_msg5"></span>
                            </div>
                            <div>
                                <span>Class B position</span><span id="stat_last_minute_msg1819"></span>
                            </div>
                            <div>
                                <span>Class B static</span><span id="stat_last_minute_msg24"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Base station</span><span id="stat_last_minute_msg4"></span>
                            </div>
                            <div>
                                <span>SAR aircraft</span><span id="stat_last_minute_msg9"></span>
                            </div>
                            <div>
                                <span>Aid-to-Navigation</span><span id="stat_last_minute_msg21"></span>
                            </div>
                            <div>
                                <span>Other</span><span id="stat_last_minute_msgother"></span>
                            </div>
                        </section>
                    </div>

                    <div class="stat-panel">

                        <header>Previous Hour</header>


                        <section>
                            <div>
                                <span>Total messages</span><span id="stat_last_hour_count"></span>
                            </div>
                            <div>
                                <span>Vessels seen</span><span id="stat_last_hour_vessel_count"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Channel A</span><span id="stat_last_hour_channel0"></span>
                            </div>
                            <div>
                                <span>Channel B</span><span id="stat_last_hour_channel1"></span>
                            </div>
                            <div>
                                <span>Channel C</span><span id="stat_last_hour_channel2"></span>
                            </div>
                            <div>
                                <span>Channel D</span><span id="stat_last_hour_channel3"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Class A position</span><span id="stat_last_hour_msg123"></span>
                            </div>
                            <div>
                                <span>Class A static</span><span id="stat_last_hour_msg5"></span>
                            </div>
                            <div>
                                <span>Class B position</span><span id="stat_last_hour_msg1819"></span>
                            </div>
                            <div>
                                <span>Class B static</span><span id="stat_last_hour_msg24"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Base station</span><span id="stat_last_hour_msg4"></span>
                            </div>
                            <div>
                                <span>SAR aircraft</span><span id="stat_last_hour_msg9"></span>
                            </div>
                            <div>
                                <span>Aid-to-Navigation</span><span id="stat_last_hour_msg21"></span>
                            </div>
                            <div>
                                <span>Other</span><span id="stat_last_hour_msgother"></span>
                            </div>
                        </section>
                    </div>

                    <div class="stat-panel">

                        <header>Previous Day</header>

                        <section>
                            <div>
                                <span>Total messages</span><span id="stat_last_day_count"></span>
                            </div>
                            <div>
                                <span>Vessels seen</span><span id="stat_last_day_vessel_count"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Channel A</span><span id="stat_last_day_channel0"></span>
                            </div>
                            <div>
                                <span>Channel B</span><span id="stat_last_day_channel1"></span>
                            </div>
                            <div>
                                <span>Channel C</span><span id="stat_last_day_channel2"></span>
                            </div>
                            <div>
                                <span>Channel D</span><span id="stat_last_day_channel3"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Class A position</span><span id="stat_last_day_msg123"></span>
                            </div>
                            <div>
                                <span>Class A static</span><span id="stat_last_day_msg5"></span>
                            </div>
                            <div>
                                <span>Class B position</span><span id="stat_last_day_msg1819"></span>
                            </div>
                            <div>
                                <span>Class B static</span><span id="stat_last_day_msg24"></span>
                            </div>
                        </section>
                        <section>
                            <div>
                                <span>Base station</span><span id="stat_last_day_msg4"></span>
                            </div>
                            <div>
                                <span>SAR aircraft</span><span id="stat_last_day_msg9"></span>
                            </div>
                            <div>
                                <span>Aid-to-Navigation</span><span id="stat_last_day_msg21"></span>
                            </div>
                            <div>
                                <span>Other</span><span id="stat_last_day_msgother"></span>
                            </div>
                        </section>
                    </div>

                </div>
            </div>

            <div class="tabcontent addscrollbar" id="plots">
                <div class="graphtab">
                    <div class="graph-panel">
                        <header>Messages per Second</header>
                        <canvas id="chart-seconds"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Messages per Minute</header>
                        <canvas id="chart-minutes"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Messages per Hour</header>
                        <canvas id="chart-hours"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Messages per Day</header>
                        <canvas id="chart-days"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Vessels per Minute</header>
                        <canvas id="chart-vessels-minute"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Frequency Shift (avg PPM per hour)</header>
                        <canvas id="chart-ppm"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Frequency Shift (avg PPM per minute)</header>
                        <canvas id="chart-ppm-minute"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Signal Level (Min/Max dB per minute)</header>
                        <canvas id="chart-level"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Distance (Max <span class="distunit">NMi</span> per Hour)</header>
                        <canvas id="chart-distance-hour"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Distance (Max <span class="distunit">NMi</span>  per Day)</header>
                        <canvas id="chart-distance-day"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Max Distance Last Hour (<span class="distunit">NMi</span>)</header>
                        <canvas id="chart-radar-hour"></canvas>
                    </div>
                    <div class="graph-panel">
                        <header>Max Distance Last Day (<span class="distunit">NMi</span>)</header>
                        <canvas id="chart-radar-day"></canvas>
                    </div>
                </div>
            </div>

            <div class="tabcontent" id="ships">
                <div class="tablesection">
                    <div id="shipTable"></div>
                </div>
            </div>

            <div class="tabcontent" id="map">
                <aside id="shipcard" class="shipcard-ismax">

                    <header id="shipcard_header">
                        <span onclick="toggleShipcardSize()" id="shipcard_header_title"></span>
                        <span><i onclick="mapResetView(13)" id="shipcard_zoom_button" class="hide shipcard-header-icon zoom_in_icon"></i></span>
                        <span><i onclick="toggleShipcardSize()" id="shipcard_minmax_button" class="shipcard-header-icon keyboard_arrow_up_icon"></i></span>
                        <span><i onclick="showContextMenu(event,card_mmsi,[/*'settings', 'ctx-map',*/ 'mmsi', 'mmsi-map'])" class="shipcard-header-icon more_vert_icon"></i></span>
                        <span><i onclick="showShipcard(null)" style="color: red;" class="shipcard-header-icon close_icon"></i></span>
                    </header>


                    <div id="shipcard_content">
                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-max-only">
                            <div><span>Status</span><span id="shipcard_status"></span></div>
                            <div><span>Ship type</span><span id="shipcard_shiptype"></span></div>
                        </div>

                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-max-only">
                            <div><span>Country</span><span id="shipcard_country"></span></div>
                            <div><span>Sender</span><span id="shipcard_type"></span></div>
                        </div>

                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-max-only">
                            <div><span>MMSI</span><span id="shipcard_mmsi">-</span></div>
                            <div><span>Callsign</span><span id="shipcard_callsign">-</span></div>
                            <div><span>IMO</span><span id="shipcard_imo">-</span></div>
                        </div>

                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-row-selected">
                            <div><span>Course</span><span id="shipcard_cog">-</span></div>
                            <div><span>Speed</span><span id="shipcard_speed">-</span></div>
                            <div><span>Heading</span><span id="shipcard_heading">-</span></div>
                        </div>

                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-max-only ">
                            <div><span>Latitude</span><span id="shipcard_lat">-</span></div>
                            <div><span>Longitude</span><span id="shipcard_lon">-</span></div>
                            <div><span>Distance</span><span id="shipcard_distance">-</span></div>
                        </div>

                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-max-only">
                            <div><span>Destination</span><span id="shipcard_destination"></span></div>
                            <div><span>ETA</span><span id="shipcard_eta"></span></div>
                        </div>

                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-max-only">
                            <div><span>last signal</span><span id="shipcard_last_signal"></span></div>
                            <div><span>Source</span><span id="shipcard_last_group"></span></div>
                            <div><span>Count</span><span id="shipcard_count">-</span></div>
                        </div>

                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-max-only">
                            <div><span>RSSI</span><span id="shipcard_level">-</span></div>
                            <div><span>Drift</span><span id="shipcard_ppm">-</span></div>
                            <div><span>Received</span><span id="shipcard_sources">-</span></div>
                        </div>

                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-max-only">
                            <div><span>Dimension</span><span id="shipcard_dimension">-</span></div>
                            <div><span>Draught</span><span id="shipcard_draught">-</span></div>
                        </div>

                        <div onclick="shipcardselect(this)" class="shipcard-content-row shipcard-max-only">
                            <div><span>Msg type</span><span id="shipcard_msgtypes">-</span></div>
                            <div><span>Channels</span><span id="shipcard_channels">-</span></div>
                        </div>

                    </div>
                    <footer id="shipcard_footer" class="shipcard-footer shipcard-max-only">
                        <div title="Center map on current vessel" onclick="mapResetView(13)">
                            <i class="zoom_in_icon"></i><span>Zoom</span>
                        </div>
                        <div title="Track of current vessel" onclick="toggleTrackCard()">
                            <i class="timeline_icon" "></i><span id="shipcard_track">Track</span>
                        </div>
                    </footer>

                </aside>

                <div oncontextmenu="showContextMenu(event,0,['settings','ctx-map'])" class="maptab">
                    <div id="leaflet_map"></div>
                </div>
            </div>

        </div>
    </div>
    <div class="bottombar"></div>

    <script>
        var interval, hist, ships, paths = {}, markers = {}, ship_shape = {}, map, basemaps = {}, overlapmaps = {}, station = {}, shipsDB = {}, singleClickTimeout = null;
        var iconLabelSpan = null, iconStationSpan = null, evtSource = null;

        var rtCount = 0;
        var StationControlDiv = null;
        var plugins = "", plugins_main = [];
        var card_mmsi = null, hover_mmsi = null, build_string = "unknown";
        var refreshIntervalMs = 2500;
        var range_update_time = null;
        let updateInProgress = false;
        let activeTileLayer = null;

        var marker_center = null, marker_range = null, marker_station = null, marker_focus = null, marker_hover = null, marker_tracks = {};

        var context_text = "";
        // default settings
        var settings = { counter: true, fading: false, android: false, welcome: true, map_day: 'Voyager', map_night: 'DarkMatter', zoom: 10, lat: 0, lon: 0, fix_center: false, center_point: "station", tooltipLean: true, tooltipOverlap: false, dark_mode: false, center_radius: 0, metric: "DEFAULT", setcoord: true, sort: 'distance', sort_dir: 'asc', tab: 'stat', labels: true, eri: true, loadURL: true };
        let isFetchingShips = false;

        // some functions useful in plugins
        function addTileLayer(title, layer) { basemaps[title] = layer; }
        function removeTileLayer(title) { delete basemaps[title]; }
        function removeTileLayerAll() { basemaps = {}; }
        function addOverlayLayer(title, layer) { overlapmaps[title] = layer; }
        function removeOverlayLayer(title) { delete overlapmaps[title]; }
        function removeOverlayLayerAll() { overlapmaps = {}; }
        function addControlToMap(c) { c.addTo(map); }

        // transformations - for overwrite
        //getDimensionVal = c => Number(c).toFixed(0);
        //getDimensionUnit = c => "m";
        //getDistanceVal = c => Number(c).toFixed(1);
        //getDistanceUnit = c => "nmi";
        //getSpeedVal = c => Number(c).toFixed(1);
        //getSpeedUnit = c => "kts";
        getDimensionVal = c => settings.metric === "DEFAULT" ? Number(c).toFixed(0) : settings.metric === "SI" ? (Number(c).toFixed(0)) : (Number(c * 3.2808399).toFixed(0));
        getDimensionUnit = () => settings.metric === "DEFAULT" ? "m" : settings.metric === "SI" ? "m" : "ft";
        getDistanceConversion = c => settings.metric === "DEFAULT" ? c : settings.metric === "SI" ? (c * 1.852) : (c * 1.15078);
        getDistanceVal = c => Number(getDistanceConversion(c)).toFixed(1);
        getDistanceUnit = () => settings.metric === "DEFAULT" ? "nmi" : settings.metric === "SI" ? "km" : "mi";
        getSpeedVal = c => settings.metric === "DEFAULT" ? Number(c).toFixed(1) : settings.metric === "SI" ? (Number(c * 1.852).toFixed(1)) : (Number(c * 1.151).toFixed(1));
        getSpeedUnit = () => settings.metric === "DEFAULT" ? "kts" : settings.metric === "SI" ? "km/h" : "mph";

        getLatVal = ship => (ship.approx ? "<i>" : "") + Number(ship.lat).toFixed(5) + (ship.approx ? "</i>" : "");
        getLonVal = ship => (ship.approx ? "<i>" : "") + Number(ship.lon).toFixed(5) + (ship.approx ? "</i>" : "");
        getEtaVal = ship => (("0" + ship.eta_month).slice(-2)) + "-" + (("0" + ship.eta_day).slice(-2)) + " " + (("0" + ship.eta_hour).slice(-2)) + ":" + (("0" + ship.eta_minute).slice(-2));
        getDeltaTimeVal = s => s < 60 ? s + "s" : s < 60 * 60 ? Math.floor(s / 60) + "m " + (s % 60) + "s" : Math.floor(s / 3600) + "h " + Math.floor((s % 3600) / 60) + "m";
        getShipName = ship => ship.shipname;
        getCallSign = ship => ship.callsign;
        includeShip = ship => true;

        // https://stackoverflow.com/questions/51805395/navigator-clipboard-is-undefined
        async function copyClipboard(t) {
            try {
                await copyToClipboard(t);
            } catch (error) {
                showDialog("Action", "No privilege for program to copy to the clipboard. Please select and copy (CTRL-C) the following string manually: " + t);
            }
        }

        async function copyToClipboard(textToCopy) {
            // Navigator clipboard api needs a secure context (https)
            if (navigator.clipboard && window.isSecureContext) {
                await navigator.clipboard.writeText(textToCopy);
            } else {
                // Use the 'out of viewport hidden text area' trick
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;

                // Move textarea out of the viewport so it's not visible
                textArea.style.position = "absolute";
                textArea.style.left = "-999999px";

                document.body.prepend(textArea);
                textArea.select();

                try {
                    document.execCommand('copy');
                } catch (error) {
                    console.error(error);
                } finally {
                    textArea.remove();
                }
            }
        }

        function copyCoordinates(m) {
            let coords = 'not found';

            if (m in shipsDB)
                coords = shipsDB[m].raw.lat + "," + shipsDB[m].raw.lon;
            copyClipboard(coords);
        }

        async function fetchJSON(l, m) {
            try {
                response = await fetch(l + '?' + m);
            } catch (error) {
                showialog("Error", error);
            }
            return response.text();
        }

        async function showNMEA(m) {

            if (typeof message_save !== 'undefined' && message_save) {
                const s = await fetchJSON('message', m);
                const obj = JSON.parse(s);

                let tableHtml = '<table>';
                for (let key in obj) {
                    let value = obj[key];
                    if (Array.isArray(value)) {
                        value = JSON.stringify(value).replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/'/g, '\\\'').replace(/"/g, '\\"');
                    }
                    tableHtml += '<tr><td>' + key + '</td><td oncontextmenu=\'showContextMenu(event,"' + value + ' ",["settings","copy-text"])\'>' + value + '</td></tr>';

                    //tableHtml += '<tr><td>' + key + '</td><td oncontextmenu=\'showContextMenu(event,"' + value + '",["copy-text"])\'>' + value + '</td></tr>';
                }
                tableHtml += '</table>';

                showDialog('Message ' + m, tableHtml);
            } else {
                showDialog('Error', 'Please enable "-N MSG on" in AIS-catcher settings.');
            }
        }



        async function showVesselDetail(m) {

            s = await fetchJSON('vessel', m);
            let obj = JSON.parse(s);

            let tableHtml = '<table>';
            for (let key in obj) {
                tableHtml += '<tr><td>' + key + '</td><td>' + obj[key] + '</td></tr>';
            }
            tableHtml += '</table>';

            showDialog("Vessel " + m, tableHtml);
        }

        function copyText(m) {
            copyClipboard(m);
        }

        function openGoogleSearch(m) {
            window.open("https://www.google.com/search?q=" + m);
        }

        function openMarineTraffic(m) {
            window.open(" https://www.marinetraffic.com/en/ais/details/ships/mmsi:" + m);
        }

        function openShipXplorer(m) {
            window.open("https://www.shipxplorer.com/data/vessels/IMO-MMSI-" + m);
        }

        function openVesselFinder(m) {
            window.open("https://www.vesselfinder.com/vessels/details/" + m);
        }

        function openAISHub(m) {
            window.open("https://www.aishub.net/vessels?Ship[mmsi]=" + m);
        }

        function showContextMenu(event, mmsi, context) {
            var contextMenu = document.getElementById('context-menu');

            if (event && event.preventDefault) {
                event.preventDefault();
                event.stopPropagation();
            }

            document.getElementById("ctx_labelswitch").textContent = settings.labels ? "Hide ship labels" : "Show ship labels";
            document.getElementById("ctx_tooltipstyling").textContent = settings.tooltipLean ? "Show detailed ship labels" : "Show text-only ship labels";
            document.getElementById("ctx_tooltipoverlap").textContent = settings.tooltipOverlap ? "De-clutter ship labels" : "Allow overlapping ship labels";
            document.getElementById("ctx_range").textContent = settings.show_range ? "Hide station range" : "Show station range";
            document.getElementById("ctx_fading").textContent = settings.fading ? "Show icons without fading" : "Show icons with fading";

            context_mmsi = mmsi;

            const classList = ['station', 'settings', 'mmsi-map', 'mmsi', 'ctx-map', 'copy-text', 'table-menu'];

            classList.forEach(className => {
                const shouldDisplay = context.includes(className);
                const elements = document.querySelectorAll('.' + className);
                elements.forEach(element => { element.style.display = shouldDisplay ? 'flex' : 'none'; });
            });

            // we might have made non-android items visible in the context menu, so hide non-android items if needed
            updateAndroid();

            document.getElementById("ctx_menu_unpin").style.display = (settings.fix_center && context.includes("ctx-map")) ? "flex" : "none";
            document.getElementById("ctx_track").innerText = (context_mmsi in marker_tracks && context.includes("mmsi-map")) ? "Hide Track" : "Show Track";

            contextMenu.style.display = 'block';

            if (context.includes('center')) {
                contextMenu.style.left = '50%';
                contextMenu.style.top = '50%';
                contextMenu.style.transform = 'translate(-50%, -50%)';
            } else {
                contextMenu.style.left = (event.pageX + 5) + 'px';
                contextMenu.style.top = (event.pageY + 5) + 'px';
                contextMenu.style.transform = 'none';

                var contextMenuRect = contextMenu.getBoundingClientRect();
                var viewportWidth = (window.innerWidth && window.outerWidth)
                    ? Math.min(window.innerWidth, window.outerWidth)
                    : document.documentElement.clientWidth;

                var viewportHeight = (window.innerHeight && window.outerHeight)
                    ? Math.min(window.innerHeight, window.outerHeight)
                    : document.documentElement.clientHeight;

                var maxX = viewportWidth - contextMenuRect.width;
                var maxY = viewportHeight - contextMenuRect.height;

                var adjustedX = Math.max(0, Math.min(event.pageX + 5, maxX));
                var adjustedY = Math.max(0, Math.min(event.pageY + 5, maxY));

                contextMenu.style.left = adjustedX + 'px';
                contextMenu.style.top = adjustedY + 'px';
            }

            document.addEventListener('click', function hideContextMenu(event) {
                contextMenu.style.display = 'none';
                document.removeEventListener('click', hideContextMenu);
            });
        }


        function showDialog(title, message) {
            var dialogBox = document.getElementById('dialog-box');
            var dialogTitle = dialogBox.querySelector('.dialog-title');
            var dialogMessage = dialogBox.querySelector('.dialog-message');

            dialogTitle.innerText = title;
            dialogMessage.innerHTML = message;
            dialogBox.classList.remove('hidden');
        }

        function closeDialog() {
            var dialogBox = document.getElementById('dialog-box');
            dialogBox.classList.add('hidden');
        }

        function getStatusVal(ship) {
            const StringFromStatus = ["Under way using engine",
                "At anchor",
                "Not under command",
                "Restricted manoeuverability",
                "Constrained",
                "Moored",
                "Aground",
                "Engaged in Fishing",
                "Under way sailing",
                "Reserved for HSC",
                "Reserved for WIG",
                "Reserved",
                "Reserved",
                "Reserved",
                "AIS-SART is active",
                "Not available"
            ];

            return StringFromStatus[Math.min(ship.status, 15)];
        }

        function getShipTypeVal(s) {
            if (s < 20) return "Not available";
            if (s <= 29) return "WIG";
            if (s <= 30) return "Fishing";
            if (s <= 32) return "Towing";
            if (s <= 34) return "Dredging/Diving ops";
            if (s <= 35) return "Military";
            if (s <= 36) return "Sailing";
            if (s <= 37) return "Pleasure Craft";
            if (s <= 39) return "Reserved";
            if (s <= 49) return "High Speed Craft";
            if (s <= 50) return "Pilot";
            if (s <= 51) return "Search And Rescue";
            if (s <= 52) return "Tug";
            if (s <= 53) return "Port tender";
            if (s <= 54) return "Anti-pollution equipment";
            if (s <= 55) return "Law Enforcement";
            if (s <= 57) return "Local Vessel";
            if (s <= 58) return "Medical Transport";
            if (s <= 59) return "Noncombatant ship";
            if (s <= 69) return "Passenger";
            if (s <= 79) return "Cargo";
            if (s <= 89) return "Tanker";
            if (s <= 99) return "Other";

            if ((settings.eri == true || settings.eri === "true") && ((s >= 1500 && s <= 1920) || (s >= 8000 && s <= 8510))) {
                switch (s) {
                    case 8000: return "Unknown (inland AIS)";
                    case 8010: return "Motor Freighter";
                    case 8020: return "Motor Tanker";
                    case 8021: return "Motor Tanker (liquid)";
                    case 8022: return "Motor Tanker (liquid)";
                    case 8023: return "Motor Tanker (dry)";
                    case 8030: return "Container";
                    case 8040: return "Gas Tanker";
                    case 8050: return "Motor Freighter (tug)";
                    case 8060: return "Motor Tanker (tug)";
                    case 8070: return "Motor Freighter (alongside)";
                    case 8080: return "Motor Freighter (with tanker)";
                    case 8090: return "Motor Freighter (pushing)";
                    case 8100: return "Motor Freighter (pushing)";
                    case 8110: return "Tug, Freighter";
                    case 8120: return "Tug, Tanker";
                    case 8130: return "Tug Freighter (coupled)";
                    case 8140: return "Tug, freighter/tanker";
                    case 8150: return "Freightbarge";
                    case 8160: return "Tankbarge";
                    case 8161: return "Tankbarge (liquid)";
                    case 8162: return "Tankbarge (liquid)";
                    case 8163: return "Tankbarge (dry)";
                    case 8170: return "Freightbarge (with containers)";
                    case 8180: return "Tankbarge (gas)";
                    case 8210: return "Pushtow (one cargo barge)";
                    case 8220: return "Pushtow (two cargo barges)";
                    case 8230: return "Pushtow, (three cargo barges)";
                    case 8240: return "Pushtow (four cargo barges)";
                    case 8250: return "Pushtow (five cargo barges)";
                    case 8260: return "Pushtow (six cargo barges)";
                    case 8270: return "Pushtow (seven cargo barges)";
                    case 8280: return "Pushtow (eigth cargo barges)";
                    case 8290: return "Pushtow (nine or more barges)";
                    case 8310: return "Pushtow (one tank/gas barge)";
                    case 8320: return "Pushtow (two barges)";
                    case 8330: return "Pushtow (three barges)";
                    case 8340: return "Pushtow (four barges)";
                    case 8350: return "Pushtow (five barges)";
                    case 8360: return "Pushtow (six barges)";
                    case 8370: return "Pushtow (seven barges)";
                    case 8380: return "Pushtow (eight barges)";
                    case 8390: return "Pushtow (nine or more barges)";
                    case 8400: return "Tug (single)";
                    case 8410: return "Tug (one or more tows)";
                    case 8420: return "Tug (assisting)";
                    case 8430: return "Pushboat (single)";
                    case 8440: return "Passenger";
                    case 8441: return "Ferry";
                    case 8442: return "Red Cross";
                    case 8443: return "Cruise";
                    case 8444: return "Passenger";
                    case 8450: return "Service, Police or Port Service";
                    case 8460: return "Maintainance Craft";
                    case 8470: return "Object (towed)";
                    case 8480: return "Fishing";
                    case 8490: return "Bunkership";
                    case 8500: return "Barge, Tanker, Chemical";
                    case 8510: return "Object";
                    case 1500: return "General";
                    case 1510: return "Unit Carrier Maritime";
                    case 1520: return "bulk Carrier Maritime";
                    case 1530: return "Tanker";
                    case 1540: return "Liquified Gas Tanker";
                    case 1850: return "Pleasure";
                    case 1900: return "Fast Ship";
                    case 1910: return "Hydrofoil";
                    case 1920: return "Catamaran Fast";
                }
            }
            return "Unknown (" + s + ")";
        }

        const ShippingClass = {
            CARGO: 0,
            B: 1,
            PASSENGER: 2,
            SPECIAL: 3,
            TANKER: 4,
            HIGHSPEED: 5,
            PLANE: 6,
            HELICOPTER: 7,
            STATION: 8,
            ATON: 9,
            SARTEPIRB: 10,
            FISHING: 12,
            OTHER: 13
        };

        // MMSI types from AIS-catcher
        const OTHER = 0;
        const CLASS_A = 1;
        const CLASS_B = 2;
        const BASESTATION = 3;
        const SAR = 4;
        const SARTEPIRB = 5;
        const ATON = 6;

        const CLASS_A_MASK = 1 << 1 | 1 << 2 | 1 << 3;
        const CLASS_B_MASK = 1 << 18 | 1 << 19;

        const CLASS_A_STATIC_MASK = 1 << 5;
        const CLASS_B_STATIC_MASK = 1 << 24;

        const BASESTATION_MASK = 1 << 4 | 1 << 16 | 1 << 17 | 1 << 20 | 1 << 22 | 1 << 23;
        const SAR_MASK = 1 << 9;
        const ATON_MASK = 1 << 21;

        function getMMSItype(ship) {

            if ((ship.mmsi > 111000000 && ship.mmsi < 111999999) ||
                (ship.mmsi > 11100000 && ship.mmsi < 11199999))
                return SAR;

            if (ship.msg_type & CLASS_A_MASK) return CLASS_A;
            if (ship.msg_type & CLASS_B_MASK) return CLASS_B;

            if (ship.msg_type & BASESTATION_MASK) return BASESTATION;
            if (ship.msg_type & SAR_MASK) return SAR;
            if (ship.msg_type & ATON_MASK) return ATON;

            if (ship.mmsi >= 97000000 && ship.mmsi <= 98000000)
                return SARTEPIRB;

            if (ship.msg_type & CLASS_A_STATIC_MASK) return CLASS_A;
            if (ship.msg_type & CLASS_B_STATIC_MASK) return CLASS_B;

            return OTHER;
        }

        function getShipTypeClassEri(ship) {
            switch (ship.shiptype) {
                case 8030:
                case 8010:
                case 8070:
                case 8210:
                case 8220:
                case 8230:
                case 8240:
                case 8250:
                case 8260:
                case 8270:
                case 8280:
                case 8290:
                case 8310:
                case 8320:
                case 8330:
                case 8340:
                case 8350:
                case 8360:
                case 8370:
                case 8380:
                case 8390:
                case 8130:
                case 8140:
                case 8150:
                case 8170:
                case 8410: return ShippingClass.CARGO;
                case 8020:
                case 8021:
                case 8022:
                case 8023:
                case 8040:
                case 8060:
                case 8160:
                case 8161:
                case 8162:
                case 8163:
                case 8180:
                case 8490:
                case 8500:
                case 1530:
                case 1540: return ShippingClass.TANKER;
                case 8050:
                case 8080:
                case 8090:
                case 8100:
                case 8110:
                case 8120:
                case 8400:
                case 8420:
                case 8430:
                case 8450:
                case 8460:
                case 8470:
                case 8510: return ShippingClass.SPECIAL;
                case 8440:
                case 8441:
                case 8442:
                case 8443:
                case 8444: return ShippingClass.PASSENGER;
                case 8480: return ShippingClass.FISHING;
                case 1850: return ShippingClass.B;
                case 1900:
                case 1910:
                case 1920: return ShippingClass.HIGHSPEED;
            }
            return ShippingClass.OTHER;
        }

        function getShipTypeClass(ship) {

            let c = ShippingClass.UNKNOWN;

            switch (ship.mmsi_type) {
                case CLASS_A:
                case CLASS_B:
                    if (ship.mmsi_type == CLASS_B)
                        c = ShippingClass.B;
                    else
                        c = ShippingClass.UNKNOWN;

                    // overwrite default if we have a better mapping
                    if (ship.shiptype >= 80 && ship.shiptype < 90) c = ShippingClass.TANKER;
                    else if (ship.shiptype >= 70 && ship.shiptype < 80) c = ShippingClass.CARGO;
                    else if (ship.shiptype >= 60 && ship.shiptype < 70) c = ShippingClass.PASSENGER
                    else if (ship.shiptype >= 40 && ship.shiptype < 50) c = ShippingClass.HIGHSPEED;
                    else if (ship.shiptype >= 50 && ship.shiptype < 60) c = ShippingClass.SPECIAL;
                    else if (ship.shiptype == 30) c = ShippingClass.FISHING;
                    else if ((settings.eri == true || settings.eri === "true") && ((ship.shiptype >= 1500 && ship.shiptype <= 1920) || (ship.shiptype >= 8000 && ship.shiptype <= 8510)))
                        c = getShipTypeClassEri(ship);
                    break;
                case BASESTATION:
                    c = ShippingClass.STATION;
                    break;
                case SAR:
                    c = ShippingClass.HELICOPTER;
                    if (ship.mmsi > 111000000 && ship.mmsi < 111999999) {
                        if (Math.floor((ship.mmsi / 100) % 10, 0) == 1) c = ShippingClass.PLANE;
                    }
                    else if (ship.mmsi > 11100000 && ship.mmsi < 11199999)
                        if (Math.floor((ship.mmsi / 10) % 10, 0) == 1) c = ShippingClass.PLANE;
                    break;
                case SARTEPIRB:
                    c = ShippingClass.SARTEPIRB;
                    break;
                case ATON:
                    c = ShippingClass.ATON;
                    break;
            }

            return c;
        }


        function headerClick() {
            window.open('https://github.com/jvde-github/AIS-catcher');
        }

        function removeTileLayer() {
            map.eachLayer(function (layer) {
                if (layer instanceof L.TileLayer) {
                    map.removeLayer(layer);
                }
            });
        }

        function updateMapLayer() {
            if (activeTileLayer) {
                removeTileLayer();
                addMapLayer();
            }
        }

        function addMapLayer() {
            if (settings.dark_mode)
                activeTileLayer = ((settings.map_night in basemaps) ? basemaps[settings.map_night] : basemaps[Object.keys(basemaps)[0]]);
            else
                activeTileLayer = ((settings.map_day in basemaps) ? basemaps[settings.map_day] : basemaps[Object.keys(basemaps)[0]]);

            activeTileLayer.addTo(map);
        }

        function initMap() {

            map = L.map('map', { zoomControl: false, zoomSnap: 0.01 }).setView([settings.lat, settings.lon], settings.zoom);
            var control = L.control.layers(basemaps, overlapmaps, { title: 'Select map and overlays', position: 'bottomright' }).addTo(map);
            map.on('baselayerchange', function (event) { if (settings.dark_mode) settings.map_night = event.name; else settings.map_day = event.name; saveSettings(); });
            map.on('mousemove', function (evt) { saveSettings(); updateTooltips(); });
            map.on('zoomend', function (evt) { saveSettings(); updateTooltips(); });
            map.on('click', function () {
                if (singleClickTimeout == null) {
                    singleClickTimeout = setTimeout(() => { showShipcard(null); hideMenuifSmall(); closeDialog(); singleClickTimeout = null; }, 400);
                }
            });
            map.on('dblclick dragstart zoomstart', function () { if (singleClickTimeout != null) { clearTimeout(singleClickTimeout); singleClickTimeout = null; } });

            map.addControl(new L.Control.Zoom({ position: 'bottomright' }));
            L.control.scale().addTo(map);

            addMapLayer();

            map.createPane("locationMarker");
            map.getPane("locationMarker").style.zIndex = 999;

            map.createPane('stationPane');
            map.getPane('stationPane').style.zIndex = 550;

            L.DomEvent.disableClickPropagation(document.getElementById('shipcard'));
            addWrenchControl();
            addMarkerCount();
        }


        function toggleLabel() {
            settings.labels = !settings.labels;
            saveSettings();

            if (!settings.labels) {
                for (let [key, m] of Object.entries(markers))
                    if (m.isTooltipOpen()) m.getTooltip().toggle();
            }
            else
                updateTooltips();
        }


        function updateMarkerCount() {
            let count = 0;
            if (shipsDB != null) {
                count = Object.keys(markers).length;
            }
            let e = document.getElementById('markerCount');
            if (e != null)
                e.innerText = count;
        }

        function addMarkerCount() {
            if (settings.counter === "false") return;

            var markerCountControl = L.control({ position: 'topright' });

            markerCountControl.onAdd = function (map) {
                var controlDiv = L.DomUtil.create('div', 'leaflet-control-layers round-control min-height-300');
                controlDiv.title = "Ship count on map";
                var controlBoundary = L.DomUtil.create('div', 'leaflet-control-settings-toggle round-control', controlDiv);
                iconLabelSpan = L.DomUtil.create('span', '', controlBoundary);
                iconLabelSpan.innerHTML = '<span id="markerCount">0</span>';
                iconLabelSpan.style.padding = "5px";
                iconLabelSpan.style.fontSize = 12 + "px";
                return controlDiv;
            };

            addControlToMap(markerCountControl);
            updateMarkerCount();

        }
        function addWrenchControl() {
            var wrenchControl = L.control({ position: 'bottomright' });

            wrenchControl.onAdd = function (map) {
                var controlDiv = L.DomUtil.create('div', 'leaflet-control-layers');
                controlDiv.title = "More options...";
                var controlBoundary = L.DomUtil.create('div', 'leaflet-control-settings-toggle', controlDiv);
                iconLabelSpan = L.DomUtil.create('span', 'more_horiz_icon', controlBoundary);
                iconLabelSpan.innerHTML = "";
                iconLabelSpan.style.padding = "6px";

                controlDiv.addEventListener('click', function (event) { showContextMenu(event, "", ['settings', 'center', 'ctx-map']); });
                return controlDiv;
            };

            addControlToMap(wrenchControl);
        }

        function removeRange() {
            if (marker_range != null) {
                map.removeLayer(marker_range);
                marker_range = null;
            }
        }

        async function toggleRange() {

            const isSationSet = station && station.hasOwnProperty("lat") && station.hasOwnProperty("lon") && !(station.lat == 0 && station.lon == 0);

            if (!((typeof param_share_loc != "undefined") && param_share_loc) || !isSationSet) {
                showDialog("Error", "Unable to show range as station location not available");
                settings.show_range = false;

            }
            else
                settings.show_range = !settings.show_range;

            saveSettings();

            if (!settings.show_range)
                removeRange();
            else
                await plotRange();
        }

        function toggleFading() {
            settings.fading = !settings.fading;
        }

        function showPlugins() {
            showDialog("Plugins", "<pre>Loaded plugins:\n" + plugins + "</pre>");
        }

        async function fetchStatistics() {
            try {
                response = await fetch('stat.json');
            } catch (error) {
                setPulseError();
                return;
            }
            statistics = await response.json();
            setPulseOk();
            return statistics;
        }

        async function fetchAbout() {
            try {
                response = await fetch('about.md');
            } catch (error) {
                return;
            }
            aboutmd = await response.text();
            return aboutmd;
        }

        async function plotRange() {

            const isSationSet = station && station.hasOwnProperty("lat") && station.hasOwnProperty("lon") && !(station.lat == 0 && station.lon == 0);

            if (!isSationSet || !settings.show_range) {
                removeRange();
                return;
            }

            // we need to plot the range
            const now = new Date();

            // range plotted in last 15 minutes then return
            if (marker_range != null) {
                if (range_update_time != null && Math.floor((now - range_update_time) / 1000 / 60) < 15)
                    return;

                removeRange();
            }

            range_update_time = new Date();

            try {
                response = await fetch('history_full.json');
                h = await response.json();
            } catch (error) {
                settings.show_range = false;
                setPulseError();
                return;
            }

            setPulseOk();

            // calculate range
            const range_outline = [];

            const N = h.day.stat[0].radar_a.length;
            range = [];

            for (let i = 0; i < N; i++) {
                let m = 0;
                for (j = 0; j < h.hour.stat.length; j++) {
                    m = Math.max(m, h.hour.stat[j].radar_a[i]);
                    m = Math.max(m, h.hour.stat[j].radar_b[i]);
                }
                for (j = 0; j < h.minute.stat.length; j++) {
                    m = Math.max(m, h.minute.stat[j].radar_a[i]);
                    m = Math.max(m, h.minute.stat[j].radar_b[i]);
                }
                range.push(m);
            }

            const deltaNorth = calcOffset1M(station, 0);
            const deltaEast = calcOffset1M(station, 90);

            for (let i = 0; i < N; i++) {
                range_outline.push({
                    lat: station.lat + range[i] * deltaNorth[0] * 1000 / 0.5399568 * Math.cos(i * 2 / N * Math.PI),
                    lon: station.lon + range[i] * deltaEast[1] * 1000 / 0.5399568 * Math.sin(i * 2 / N * Math.PI)
                });

                range_outline.push({
                    lat: station.lat + range[i] * deltaNorth[0] * 1000 / 0.5399568 * Math.cos((i + 1) * 2 / N * Math.PI),
                    lon: station.lon + range[i] * deltaEast[1] * 1000 / 0.5399568 * Math.sin((i + 1) * 2 / N * Math.PI)
                });

            }

            const markerColor = getComputedStyle(document.documentElement).getPropertyValue('--range-color').trim();

            marker_range = L.polygon(range_outline, { fillOpacity: 0.025, color: markerColor, interactive: false });
            marker_range.addTo(map);
            updateRangeColor();
        }

        function updateRangeColor() {

            if (marker_range == null) return;

            const markerColor = getComputedStyle(document.documentElement).getPropertyValue('--range-color').trim();
            marker_range.setStyle({ color: markerColor });
        }

        async function fetchShips(noDoubleFetch = true) {
            if (isFetchingShips && noDoubleFetch) {
                console.log("A fetch operation is already running.");
                return false;
            }

            let ships = {};
            station = {};

            isFetchingShips = true;
            try {
                response = await fetch('ships_array.json');
            } catch (error) {
                setPulseError();
                console.log("failed loading ships: " + error);
                return false;
            }
            finally {
                isFetchingShips = false;
            }
            ships = await response.json();
            /*
                ships = JSON.parse(ships_json);
            */
            setPulseOk();


            const keys = ["mmsi", "lat", "lon", "distance", "bearing", "level", "count", "ppm", "approx", "heading", "cog", "speed", "to_bow", "to_stern", "to_starboard", "to_port", "last_group", "group_mask", "shiptype", "validated", "msg_type", "channels", "country", "status", "draught", "eta_month", "eta_day", "eta_hour", "eta_minute", "imo", "callsign", "shipname", "destination", "last_signal"];

            shipsDB = {};
            ships.values.forEach(v => {

                const s = Object.fromEntries(keys.map((k, i) => [k, v[i]]));

                if (includeShip(s)) {
                    const entry = {};
                    s.mmsi_type = getMMSItype(s);
                    entry.raw = s;
                    shipsDB[s.mmsi] = entry;
                }
            });

            if (ships.hasOwnProperty("station"))
                station = ships.station;

            center = {};
            if (String(settings.center_point).toUpperCase() == "STATION") {
                center = station;
            }
            else if (settings.center_point in shipsDB) {
                let ship = shipsDB[settings.center_point].raw;
                center = { lat: ship.lat, lon: ship.lon };
            }

            return true;
        }

        function toggleScreenSize() {
            var doc = window.document;
            var docEl = doc.documentElement;

            var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen || docEl.webkitEnterFullscreen;
            var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen || doc.webkitExitFullscreen;

            if (!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
                requestFullScreen.call(docEl);
            }
            else {
                cancelFullScreen.call(doc);
            }
        }

        function addShipcardItem(icon, txt, title, onclick) {

            const div = document.createElement('div');

            div.title = title;
            if (icon.startsWith("fa")) {
                icon = "question_mark";
            }
            //div.innerHTML = '<i class="' + icon + '"_icon"></i><span>' + txt + '</span>';
            div.innerHTML = '<i class="' + icon + '_icon"></i><span>' + txt + '</span>';

            div.setAttribute("onclick", onclick);


            document.getElementById('shipcard_footer').appendChild(div);
        }

        function hideMenu() {
            if (document.getElementById("menubar").classList.contains('visible') && !isAndroid()) {
                toggleMenu();
            }
        }

        function showMenu() {
            if (!document.getElementById("menubar").classList.contains('visible')) {
                toggleMenu();
            }
        }


        function hideMenuifSmall() {
            //if(window.matchMedia("(max-height: 1000px)").matches)
            // always hide
            hideMenu();
        }

        function toggleMenu() {
            document.getElementById("menubar").classList.toggle('visible');
            document.getElementById("menubar_mini").classList.toggle('showflex');
            document.getElementById("menubar_mini").classList.toggle('hide');

            var menuButton = document.getElementById("header_menu_button");
            menuButton.classList.toggle("menu_icon");
            menuButton.classList.toggle("close_icon");
        }

        function initFullScreen() {
            document.addEventListener("fullscreenchange", handleFullScreenChange);
            document.addEventListener("mozfullscreenchange", handleFullScreenChange);
            document.addEventListener("webkitfullscreenchange", handleFullScreenChange);
            document.addEventListener("msfullscreenchange", handleFullScreenChange);
        }

        function handleFullScreenChange() {
            var icon = document.getElementById("screentoggle-id");
            if (document.fullscreenElement) {
                icon.innerHTML = "fullscreen_exit";
            } else {
                icon.innerHTML = "fullscreen";
            }
        }


        // we calculate the lat/lon for 1m move in direction of heading
        // underlying calculation uses an offset of 100m and then scales down to 1.

        const cos100R = 0.9999999998770914;     // cos(100m / R);
        const sin100R = 1.567855942823164e-05;  // sin(100m / R)
        const rad = Math.PI / 180;
        const radInv = 180 / Math.PI;

        function calcOffset1M(latlng, heading) {

            const lat = latlng.lat * rad;

            const rheading = ((heading + 360) % 360) * rad;
            const sinLat = Math.sin(lat);
            const cosLat = Math.cos(lat);

            let sinLat2 = sinLat * cos100R + cosLat * sin100R * Math.cos(rheading);
            let lat2 = Math.asin(sinLat2);
            let deltaLon = Math.atan2(Math.sin(rheading) * sin100R * cosLat, cos100R - sinLat * sinLat2);

            // normalize to 1 meter (from 100m)
            return [(lat2 * radInv - latlng.lat) / 100, (deltaLon * radInv) / 100];
        }

        function calcMove(latlng, delta, distance) {
            return L.latLng([latlng.lat + delta[0] * distance, latlng.lng + delta[1] * distance]);
        }

        function drawShipOutline(ship) {

            if (ship == null) return;

            let style = {};

            const latlng = L.latLng(ship.lat, ship.lon);
            const to_bow = ship.to_bow, to_stern = ship.to_stern, to_port = ship.to_port, to_starboard = ship.to_starboard;
            let heading = ship.heading;
            let opacity = getShipOpacity(ship);
            let fillOpacity = 0.9 * opacity;

            if (to_bow == null || to_stern == null || to_port == null || to_starboard == null) return;

            if (heading == null) {
                style.dashArray = '5, 5';
                style.dashOffset = '0';

                if (ship.cog != null && ship.speed > 1) heading = ship.cog;
                fillOpacity = 0.2 * opacity;
            }


            let col = { color: 'darkgrey', fillColor: 'grey' };
            if (ship.mmsi == hover_mmsi) col = { color: 'orange', fillColor: 'grey' };
            else if (ship.mmsi == card_mmsi) col = { color: '#943b3e', fillColor: 'grey' };

            if (heading != null) {
                const deltaBow = calcOffset1M(latlng, (heading) % 360);
                const deltaStarboard = calcOffset1M(latlng, (heading + 90) % 360);

                const bow = calcMove(latlng, deltaBow, to_bow);
                const stern = calcMove(latlng, deltaBow, -to_stern);

                const A = calcMove(stern, deltaStarboard, to_starboard);
                const B = calcMove(stern, deltaStarboard, -to_port);
                const C = calcMove(B, deltaBow, 0.8 * (to_bow + to_stern));
                const Dmid = calcMove(C, deltaStarboard, 0.5 * (to_starboard + to_port));
                const D = calcMove(Dmid, deltaBow, 0.2 * (to_bow + to_stern));
                const E = calcMove(C, deltaStarboard, to_starboard + to_port);

                const ship_outline = [];

                ship_outline.push(A);
                ship_outline.push(B);
                ship_outline.push(C);
                ship_outline.push(D);
                ship_outline.push(E);

                return L.polygon(ship_outline, { ...col, fillOpacity: fillOpacity, opacity: opacity, ...style }).addTo(map);
            }
            else {

                const a = Math.max(to_bow, to_stern), b = Math.max(to_starboard, to_port);
                const r = Math.sqrt(a * a + b * b);

                if (r < 2 || r > 300) return null;
                return L.circle(latlng, { radius: r, ...col, fillOpacity: fillOpacity, opacity: opacity, ...style }).addTo(map);
            }

            return null;
        }

        function average(d) {
            const b = d.chart.data.datasets[0].data;
            if (b.length == 1) return b[0].y;

            let start = 0;
            if (d.chart.data.datasets.length > 1) start = 1;

            var c = 0;
            for (a = 0; a < b.length; a++) {
                if (b[a].x != 0) {
                    for (i = start; i < d.chart.data.datasets.length; i++) {
                        c += d.chart.data.datasets[i].data[a].y;
                    }
                }
            }
            return c / (b.length - 1);
        }


        const graph_annotation = {
            type: 'line',
            borderColor: 'rgba(12,118,170)',
            borderDash: [6, 6],
            borderDashOffset: 0,
            borderWidth: 3,
            scaleID: 'y',
            value: a => average(a)
        };

        const graph_options_count = {
            responsive: true,
            plugins: {
                legend: {
                    display: true,
                },
                annotation: {
                    annotations: {
                        graph_annotation
                    }
                }
            },
            elements: {
                point: {
                    radius: 1
                }
            },
            animation: false,
            tooltips: {
                mode: 'index',
                intersect: false
            },
            hover: {
                mode: 'index',
                intersect: false
            },
            scales: {
                y: {
                    stacked: true,
                    beginAtZero: true,
                    ticks: {
                        display: true
                    }
                },
                x: {
                    ticks: {
                        display: true
                    }
                }
            }
        };


        const graph_options_single = {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                },
                annotation: {
                    annotations: {
                        graph_annotation
                    }
                }
            },
            elements: {
                point: {
                    radius: 1
                }
            },
            animation: false,
            tooltips: {
                mode: 'index',
                intersect: false
            },
            hover: {
                mode: 'index',
                intersect: false
            },
            scales: {
                y: {
                    stacked: true,
                    beginAtZero: true,
                    ticks: {
                        display: true
                    }
                },
                x: {
                    ticks: {
                        display: true
                    }
                }
            }
        };

        const graph_options_level = {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            elements: {
                point: {
                    radius: 1
                }
            },
            animation: false,
            tooltips: {
                mode: 'index',
                intersect: false
            },
            hover: {
                mode: 'index',
                intersect: false
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        display: true
                    }
                },
                x: {
                    ticks: {
                        display: true
                    }
                }
            }
        };

        const graph_options_distance = {
            responsive: true,
            plugins: {
                legend: {
                    display: true,
                }
            },
            elements: {
                point: {
                    radius: 1
                }
            },
            animation: false,
            tooltips: {
                mode: 'index',
                intersect: false
            },
            hover: {
                mode: 'index',
                intersect: false
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        display: true
                    }
                },
                x: {
                    ticks: {
                        display: true
                    }
                }
            }
        };

        plot_count = {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'Vessel Count',
                        data: [],
                        type: 'line',
                        showLine: true,
                        fill: false,
                        pointStyle: false,
                        borderWidth: 2,
                    }, {
                        label: 'Class A',
                        data: [],
                        showLine: true,
                        fill: 'origin',
                        borderWidth: 2,
                        pointStyle: false,
                    },
                    {
                        label: 'Class B',
                        data: [],
                        showLine: true,
                        fill: '-1',
                        borderWidth: 2,
                        pointStyle: false
                    },
                    {
                        label: 'Base Station',
                        data: [],
                        showLine: true,
                        fill: '-1',
                        borderWidth: 2,
                        pointStyle: false
                    },
                    {
                        label: 'Other',
                        data: [],
                        showLine: true,
                        fill: '-1',
                        borderWidth: 2,
                        pointStyle: false
                    }]
            },
            options: graph_options_count
        };


        plot_distance = {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'NE',
                    data: [],
                    showLine: true,
                    pointStyle: false,
                    borderWidth: 2
                },
                {
                    label: 'SE',
                    data: [],
                    showLine: true,
                    pointStyle: false,
                    borderWidth: 2
                }, {
                    label: 'SW',
                    data: [],
                    showLine: true,
                    pointStyle: false,
                    borderWidth: 2
                },
                {
                    label: 'NW',
                    data: [],
                    showLine: true,
                    pointStyle: false,
                    borderWidth: 2
                },
                {
                    label: 'Max',
                    data: [],
                    showLine: true,
                    backgroundColor: 'rgb(211,211,211,0.9)',
                    fill: true,
                    pointStyle: false,
                    borderWidth: 0
                }]
            },
            options: graph_options_distance
        };

        plot_single = {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Data',
                    data: [],
                    showLine: true,
                    pointStyle: false,
                    borderWidth: 2
                }]
            },
            options: graph_options_single
        };

        plot_level = {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Max',
                    data: [],
                    showLine: true,
                    pointStyle: false,
                    borderWidth: 1
                }, {
                    label: 'Min',
                    data: [],
                    showLine: true,
                    pointStyle: false,
                    borderWidth: 1,
                    fill: '-1'
                }]
            },
            options: graph_options_level
        };


        var plot_radar = {
            type: "polarArea",
            animation: false,
            responsive: true,
            plugins: {
                legend: {
                    display: true
                }
            },
            data: {
                datasets: [{
                    label: 'Class B',
                    borderWidth: 1
                }, {
                    label: 'Class A',
                    borderWidth: 1
                }]
            },
            options: {
                legend: {
                    display: false
                },
                scale: {
                    ticks: {
                        min: 0,
                    }
                }
            }
        };

        function cssvar(name) {
            return getComputedStyle(document.body).getPropertyValue(name);
        }

        function updateChartColors(c, colorVariables) {
            c.data.datasets.forEach((dataset, index) => {
                const color = cssvar(colorVariables[index]);

                dataset.backgroundColor = color;
                dataset.borderColor = color;
            });

            c.options.scales.x.ticks.color = cssvar('--chart-color');
            c.options.scales.x.grid.color = cssvar('--chart-grid-color');

            c.options.scales.y.ticks.color = cssvar('--chart-color');
            c.options.scales.y.grid.color = cssvar('--chart-grid-color');

            c.options.plugins.legend.labels.color = cssvar('--chart-color');
        }

        function updateColorMulti(c) {
            const colorVariables = ['--chart4-color', '--chart1-color', '--chart2-color', '--chart5-color', '--chart6-color'];
            updateChartColors(c, colorVariables);
        }


        function updateColorSingle(c) {
            const colorVariables = ['--chart4-color', '--chart1-color', '--chart2-color', '--chart5-color', '--chart6-color'];
            updateChartColors(c, colorVariables);
        }

        function updateColorRadar(c) {
            const colorVariables = ['--chart2-color', '--chart4-color', '--chart2-color', '--chart5-color', '--chart4-color'];
            c.data.datasets.forEach((dataset, index) => {
                const color = cssvar(colorVariables[index]);

                dataset.backgroundColor = color;
                dataset.borderColor = color;
            });

            c.options.scales.r.grid.color = cssvar('--chart-grid-color');
            c.options.scales.r.ticks.color = cssvar('--chart-color');
            c.options.scales.r.ticks.backdropColor = cssvar('--panel-color');

        }

        function initPlots() {
            if (typeof Chart !== "undefined") {

                chart_radar_hour = new Chart(document.getElementById('chart-radar-hour').getContext("2d"), plot_radar);
                chart_radar_day = new Chart(document.getElementById('chart-radar-day').getContext("2d"), plot_radar);
                chart_seconds = new Chart(document.getElementById('chart-seconds'), plot_count);
                chart_minutes = new Chart(document.getElementById('chart-minutes'), plot_count);
                chart_hours = new Chart(document.getElementById('chart-hours'), plot_count);
                chart_days = new Chart(document.getElementById('chart-days'), plot_count);
                chart_ppm = new Chart(document.getElementById('chart-ppm'), plot_single);
                chart_ppm_minute = new Chart(document.getElementById('chart-ppm-minute'), plot_single);
                chart_level = new Chart(document.getElementById('chart-level'), plot_level);
                chart_distance_hour = new Chart(document.getElementById('chart-distance-hour'), plot_distance);
                chart_distance_day = new Chart(document.getElementById('chart-distance-day'), plot_distance);
                chart_minute_vessel = new Chart(document.getElementById('chart-vessels-minute'), plot_single);
            }
        }

        function shipcardismax() {
            return document.getElementById('shipcard').classList.contains('shipcard-ismax');
        }
        function shipcardselect(e) {
            if (shipcardismax()) {
                e.classList.toggle('shipcard-max-only');
                e.classList.toggle('shipcard-row-selected');
            }
            else
                toggleShipcardSize();

            saveSettings();
        }

        function toggleShipcardSize() {

            Array.from(document.getElementsByClassName('shipcard-min-only')).forEach(e => e.classList.toggle("visible"));
            Array.from(document.getElementsByClassName('shipcard-max-only')).forEach(e => e.classList.toggle("hide"));

            document.getElementById('shipcard').classList.toggle('shipcard-ismax');
            document.getElementById('shipcard_minmax_button').classList.toggle('keyboard_arrow_down_icon');
            document.getElementById('shipcard_minmax_button').classList.toggle('keyboard_arrow_up_icon');
            document.getElementById('shipcard_zoom_button').classList.toggle('hide');

            var e = document.getElementById('shipcard_content').children;

            if (shipcardismax()) {
                for (let i = 0; i < e.length; i++) {
                    if (e[i].classList.contains('shipcard-max-only') && e[i].classList.contains('shipcard-row-selected') ||
                        !e[i].classList.contains('shipcard-max-only') && !e[i].classList.contains('shipcard-row-selected'))
                        e[i].classList.toggle('shipcard-row-selected');
                }
            }
            else {
                for (let i = 0; i < e.length; i++) {
                    if (e[i].classList.contains('shipcard-row-selected'))
                        e[i].classList.toggle('shipcard-row-selected');
                }
            }
        }

        function setPulseOk() {
            document.getElementById("pulse-id").className = "header-pulse-ok";
        }

        function setPulseError() {
            document.getElementById("pulse-id").className = "header-pulse-error";
        }

        let displayNames;

        function getCountryName(isoCode) {

            if (!displayNames && typeof Intl !== 'undefined' && typeof Intl.DisplayNames === 'function') {
                displayNames = new Intl.DisplayNames(['en'], { type: 'region' });
            }

            if (displayNames) {
                return displayNames.of(isoCode);
            } else {
                return isoCode;
            }
        }

        function getFlag(country) {
            return country ? `<span style="padding-right: 10px" title="` + getCountryName(country) + `" class="fi fi-${country.toLowerCase()}"></span> ` : "<span></span>";
        }

        // fetches main statistics from the server
        async function fetchStatistics() {
            try {
                response = await fetch('stat.json');
            } catch (error) {
                setPulseError();
                return;
            }
            statistics = await response.json();
            setPulseOk();
            return statistics;
        }

        function updateStat(stat, tf) {
            [0, 1, 2, 3].forEach(e => document.getElementById('stat_' + tf + '_channel' + e).innerHTML = stat[tf].channel[e]);

            document.getElementById("stat_" + tf + "_count").innerHTML = stat[tf].count;
            document.getElementById("stat_" + tf + "_vessel_count").innerHTML = stat[tf].vessels;


            document.getElementById("stat_" + tf + "_msg123").innerHTML = stat[tf].msg[0] + stat[tf].msg[1] + stat[tf].msg[2];
            document.getElementById("stat_" + tf + "_msg5").innerHTML = stat[tf].msg[4];
            document.getElementById("stat_" + tf + "_msg1819").innerHTML = stat[tf].msg[17] + stat[tf].msg[18];
            document.getElementById("stat_" + tf + "_msg24").innerHTML = stat[tf].msg[23];
            document.getElementById("stat_" + tf + "_msg4").innerHTML = stat[tf].msg[3];
            document.getElementById("stat_" + tf + "_msg9").innerHTML = stat[tf].msg[8];
            document.getElementById("stat_" + tf + "_msg21").innerHTML = stat[tf].msg[20];

            var count_other = 0;
            [6, 7, 8, 10, 11, 12, 13, 14, 15, 16, 17, 20, 22, 23, 25, 26, 27].forEach(i => count_other += stat[tf].msg[i - 1]);
            document.getElementById("stat_" + tf + "_msgother").innerHTML = count_other;
        }

        async function updateStatistics() {
            var stat = await fetchStatistics();

            if (stat) {
                if (stat.station_link != "")
                    document.getElementById("stat_station").innerHTML = "<a href='" + stat.station_link + "'>" + stat.station + "</a>";

                var title = document.getElementById("stat_station").textContent;
                if (title != "" && title != null) document.title = "AIS-catcher " + title;

                // in bulk....
                ['os', 'hardware', 'build_describe', 'build_date', 'station', 'product', 'vendor', 'serial', 'model', 'sample_rate', 'received'].forEach(e => document.getElementById('stat_' + e).innerHTML = stat[e]);
                //['stat', 'last_minute', 'last_day', 'last_hour'].forEach(e => document.getElementById('stat_' + e + '_count').innerHTML = stat[e].count);

                document.getElementById("stat_memory").innerHTML = stat.memory ? (Number(stat.memory / 1000000).toFixed(1) + " MB") : "N/A";
                document.getElementById("stat_msg_rate").innerHTML = Number(stat.msg_rate).toFixed(1) + " msg/s";
                document.getElementById("stat_run_time").innerHTML = getDeltaTimeVal(stat.run_time);

                updateStat(stat, "total");
                updateStat(stat, "session");
                updateStat(stat, "last_minute");
                updateStat(stat, "last_hour");
                updateStat(stat, "last_day");

                document.getElementById("stat_total_vessel_count").innerHTML = "-";
                document.getElementById("stat_session_vessel_count").innerHTML = stat.vessel_count;

            }
        }

        function updateChartMulti(b, f, c) {
            if (b.hasOwnProperty(f)) {
                var hA = [];
                var hB = [];
                var hT = [];
                var hS = [];
                var hV = [];

                const source = b[f];
                for (let i = 0; i < source.time.length; i++) {
                    let cA = source.stat[i].msg[0] + source.stat[i].msg[1] + source.stat[i].msg[2] + source.stat[i].msg[4];
                    hA.push({ x: source.time[i], y: cA });
                    let cB = source.stat[i].msg[17] + source.stat[i].msg[18] + source.stat[i].msg[23];
                    hB.push({ x: source.time[i], y: cB });
                    let cS = source.stat[i].msg[3];
                    hS.push({ x: source.time[i], y: cS });
                    let cT = source.stat[i].count - cA - cB - cS;
                    hT.push({ x: source.time[i], y: cT });
                    let cV = source.stat[i].vessels;
                    hV.push({ x: source.time[i], y: cV });

                }

                c.data.datasets[0].data = hV;
                c.data.datasets[1].data = hA;
                c.data.datasets[2].data = hB;
                c.data.datasets[3].data = hS;
                c.data.datasets[4].data = hT;

                c.update();
            }
        }

        function updateChartDistance(b, f, c) {
            if (b.hasOwnProperty(f)) {
                var hNE = [];
                var hSE = [];
                var hSW = [];
                var hNW = [];
                var hM = [];

                let source = b[f];

                if (source.stat[0].radar_a.length == 0) return;
                let N = source.stat[0].radar_a.length;
                let N4 = N / 4;
                for (let i = 0; i < source.time.length; i++) {
                    let count = [0, 0, 0, 0];
                    for (let j = 0; j < N; j++)
                        count[Math.floor(j / N4)] = Math.max(count[Math.floor(j / N4)], source.stat[i].radar_a[j]);

                    hNE.push({ x: source.time[i], y: getDistanceConversion(count[0]) }); // source.stat[i].radar[0]
                    hSE.push({ x: source.time[i], y: getDistanceConversion(count[1]) });
                    hSW.push({ x: source.time[i], y: getDistanceConversion(count[2]) });
                    hNW.push({ x: source.time[i], y: getDistanceConversion(count[3]) });
                    hM.push({ x: source.time[i], y: getDistanceConversion(source.stat[i].dist) });
                }
                c.data.datasets[0].data = hNE;
                c.data.datasets[1].data = hSE;
                c.data.datasets[2].data = hSW;
                c.data.datasets[3].data = hNW;
                c.data.datasets[4].data = hM;

                c.update();
            }
        }

        function updateChartSingle(b, f1, f2, c) {
            if (b.hasOwnProperty(f1)) {
                var h = [];

                const source = b[f1];
                for (let i = 0; i < source.time.length; i++) {
                    h.push({ x: source.time[i], y: source.stat[i][f2] });
                }
                c.data.datasets[0].data = h;
                c.update();
            }
        }

        function updateChartLevel(b, f1, f2, c) {
            if (b.hasOwnProperty(f1)) {
                const source = b[f1];

                var h = [];

                for (let i = 0; i < source.time.length; i++) {
                    h.push({ x: source.time[i], y: source.stat[i].level_min == 0 ? null : source.stat[i].level_min });
                }
                c.data.datasets[1].data = h;

                var h = [];
                for (let i = 0; i < source.time.length; i++) {
                    h.push({ x: source.time[i], y: source.stat[i].level_max == 0 ? null : source.stat[i].level_max });
                }
                c.data.datasets[0].data = h;

                c.update();
            }
        }

        function updateRadar(b, f, c) {
            if (b.hasOwnProperty(f)) {
                var data_a = [], data_b = [];
                let idx = 0;
                if (b[f].stat.length > 1) idx = 1;
                let N = b[f].stat[idx].radar_a.length;
                for (var i = 0; i < N; i++) {
                    data_a.push({
                        r: getDistanceConversion(b[f].stat[idx].radar_a[i]),
                        theta: i * 360 / N
                    });
                    data_b.push({
                        r: getDistanceConversion(b[f].stat[idx].radar_b[i]),
                        theta: i * 360 / N
                    });
                }
                c.data.datasets[0].data = data_b;
                c.data.datasets[1].data = data_a;
                c.update();
            }

        }

        async function updatePlots() {

            const unit = getDistanceUnit().toUpperCase();
            document.querySelectorAll('.distunit').forEach(u => { u.textContent = unit; });

            if (true) {
                try {
                    response = await fetch('history_full.json');
                } catch (error) {
                    setPulseError();
                }
                b = await response.json();
            }
            else {
                b = JSON.parse(chart_json);
            }
            setPulseOk();

            updateChartMulti(b, 'second', chart_seconds);
            updateChartMulti(b, 'minute', chart_minutes);
            updateChartMulti(b, 'hour', chart_hours);
            updateChartMulti(b, 'day', chart_days);

            updateChartSingle(b, 'minute', 'ppm', chart_ppm_minute);
            updateChartSingle(b, 'hour', 'ppm', chart_ppm);
            updateChartLevel(b, 'minute', 'level', chart_level);
            updateChartSingle(b, 'minute', 'vessels', chart_minute_vessel);

            //plot_radar.options.ticks.scale.max = 200;
            updateChartDistance(b, 'hour', chart_distance_hour);
            updateChartDistance(b, 'day', chart_distance_day);

            updateRadar(b, 'hour', chart_radar_hour);
            updateRadar(b, 'day', chart_radar_day);
        }

        function tableRowClick(m) {
            ship = shipsDB[m].raw;
            if (ship.lat == null || ship.lon == null) return;

            selectMapTab(m);
        }

        function sortTable(e) {

            settings.sort = e.getAttribute('field');
            settings.sort_dir = settings.sort_dir == "asc" ? "dec" : "asc";

            saveSettings();
            updateShipTable()
        }

        var table = null;

        function downloadCSV() {
            if (table) table.download("csv", "data.csv");
        }

        async function updateShipTable() {

            const ok = await fetchShips();
            if (!ok) return;

            const data = Object.values(shipsDB).map(ship => ship.raw);

            if (table == null) {

                table = new Tabulator("#shipTable", {
                    index: "mmsi",
                    rowFormatter: function (row) {
                        const ship = row.getData();
                        const borderColor = ship.validated == 1 ? "#7CFC00" : (ship.validated == -1 ? "red" : "lightgrey");
                        row.getElement().style.borderLeft = `10px solid ${borderColor}`;
                    },
                    data: data,
                    persistence: true,
                    pagination: "local",
                    paginationSize: 50,
                    paginationSizeSelector: [20, 50, 100],
                    columns: [
                        {
                            title: "Shipname", field: "shipname", sorter: "string", formatter: function (cell) {
                                const ship = cell.getRow().getData();
                                return getFlag(ship.country) + getShipName(ship);
                            }
                        },
                        { title: "MMSI", field: "mmsi", sorter: "number" },
                        {
                            title: "Callsign", field: "callsign", sorter: "string", formatter: function (cell) {
                                const ship = cell.getRow().getData();
                                return ship != null ? getCallSign(ship) : "";
                            }
                        },
                        {
                            title: "Last", field: "last_signal", sorter: "number", formatter: function (cell) {
                                const value = cell.getValue();
                                return value != null ? getDeltaTimeVal(value) : "";
                            }
                        },
                        { title: "Msgs", field: "count", sorter: "number" },
                        {
                            title: "PPM", field: "ppm", sorter: "number", formatter: function (cell) {
                                const value = cell.getValue();
                                return value != null ? Number(value).toFixed(1) : "";
                            }
                        },
                        {
                            title: "RSSI", field: "level", sorter: "number", formatter: function (cell) {
                                const value = cell.getValue();
                                return value != null ? Number(value).toFixed(1) : "";
                            }
                        },
                        {
                            title: "Dist", field: "distance", sorter: "number", formatter: function (cell) {
                                const value = cell.getValue();
                                return value != null ? getDistanceVal(value) : "";
                            }
                        },
                        {
                            title: "Brg", field: "bearing", sorter: "number", formatter: function (cell) {
                                const value = cell.getValue();
                                return value != null ? Number(value).toFixed(0) + "&deg;" : "";
                            }
                        },
                        {
                            title: "Lat", field: "lat", sorter: "number", formatter: function (cell) {
                                const ship = cell.getRow().getData();
                                const color = ship.validated == 1 ? "green" : (ship.validated == -1 ? "red" : "inherited");
                                return "<div style='color:" + color + "'>" + (ship.lat != null ? getLatVal(ship) : "") + "</div>";

                            }
                        },
                        {
                            title: "Lon", field: "lon", sorter: "number", formatter: function (cell) {
                                const ship = cell.getRow().getData();
                                const color = ship.validated == 1 ? "green" : (ship.validated == -1 ? "red" : "inherited");
                                return "<div style='color:" + color + "'>" + (ship.lon != null ? getLonVal(ship) : "") + "</div>";
                            }
                        },
                        {
                            title: "Valid", field: "validated", sorter: "string", formatter: function (cell) {
                                const value = cell.getValue();
                                const txt = value == 1 ? "Yes" : (value == -1 ? "No" : "Pending");
                                return txt;
                            }
                        },
                        {
                            title: "Channels", field: "channels", sorter: "number", formatter: function (cell) {
                                const value = cell.getValue();
                                return getStringfromChannels(value);
                            }
                        },
                    ],
                });
                table.on("rowContext", function (e, row) { showContextMenu(event, row.getData().mmsi, ['settings', 'mmsi', 'table-menu']); });
                table.on("rowClick", function (e, row) { tableRowClick(row.getData().mmsi); });
            }
            else {
                if (data.length == 0) {
                    table.clearData();
                    return;
                }
                table.updateOrAddData(data);
                table.getRows().forEach(row => {
                    const mmsi = row.getData().mmsi;
                    if (!(mmsi in shipsDB))
                        row.delete();
                });
                var sorters = table.getSorters();
                table.setSort(sorters);
            }
        }

        function getTooltipContent(ship) {
            return getFlag(ship.country) + `<span><b>${getShipName(ship) || ship.mmsi}</b></span><span><br>${getDeltaTimeVal(ship.last_signal)} ago</span>`;
        }

        function createTooltip(ship) {
            const cls = settings.tooltipLean ? 'leaflet-tooltiplabel' : 'leaflet-tooltip';
            const ofs = settings.tooltipLean ? 0 : 15;
            markers[ship.mmsi].bindTooltip(getTooltipContent(ship), { className: cls, opacity: 0.85, permanent: false, offset: [ofs, 0], direction: 'right' });
            markers[ship.mmsi].closeTooltip();
        }

        function getTypeVal(ship) {
            switch (ship.mmsi_type) {
                case CLASS_A:
                    return "Ship (Class A)";
                case CLASS_B:
                    return "Ship (Class B)";
                case BASESTATION:
                    return "Base Station";
                case SAR:
                    return "SAR aircraft"
                case SARTEPIRB:
                    return "AIS SART/EPIRB";
                case ATON:
                    return "Aid-to-Navigation";
            }
            return "Unknown";
        }

        function getShipOpacity(ship) {
            if (settings.fading == false) return 1;

            let opacity = 1 - (ship.last_signal / 1800) * 0.8;
            return Math.max(0.2, Math.min(1, opacity));
        }

        function getIcon(ship) {

            const STATICON = 0;
            const SHIPICON = 1;
            const PLANEICON = 2;
            const HELICOPTERICON = 3;

            let shipicon = SHIPICON; c = 120;
            switch (getShipTypeClass(ship)) {
                case ShippingClass.CARGO:
                    shipicon = SHIPICON; c = 0; break;
                case ShippingClass.TANKER:
                    shipicon = SHIPICON; c = 80; break;
                case ShippingClass.PASSENGER:
                    shipicon = SHIPICON; c = 40; break;
                case ShippingClass.HIGHSPEED:
                    shipicon = SHIPICON; c = 100; break;
                case ShippingClass.SPECIAL:
                    shipicon = SHIPICON; c = 60; break;
                case ShippingClass.FISHING:
                    shipicon = SHIPICON; c = 140; break;
                case ShippingClass.ATON:
                    shipicon = STATICON; c = 0; break;
                case ShippingClass.PLANE:
                    shipicon = PLANEICON; break;
                case ShippingClass.HELICOPTER:
                    shipicon = HELICOPTERICON; break;
                case ShippingClass.B:
                    shipicon = SHIPICON; c = 20; break;
                case ShippingClass.STATION:
                    shipicon = STATICON; c = 20; break;
                case ShippingClass.SARTEPIRB:
                    c = 60; shipicon = STATICON; break;
            }

            let h = '';
            let opacity = getShipOpacity(ship);
            let iconStyle = `opacity: ${opacity};`;

            switch (shipicon) {
                case STATICON:
                    h = `<DIV CLASS="staticon" style="background-position: -${c}px -20px; transform: translate(-4px,-4px); ${iconStyle}"></DIV>`;
                    break;
                case SHIPICON:
                    if (ship.speed != null && ship.speed > 0.5 && ship.cog != null)
                        h = `<DIV CLASS="shipicon" style="background-position: -${c}px 0; transform: translate(-3px,-3px) rotate(${ship.cog}deg); ${iconStyle}"></DIV>`;
                    else
                        h = `<DIV CLASS="shipicon" style="background-position: -${c}px -20px; transform: translate(-4px,-5px); ${iconStyle}"></DIV>`;
                    break;
                case PLANEICON:
                    h = `<DIV CLASS="planeicon" style="background-position: 0px 0; transform: translate(-6px,-6px) rotate(${ship.cog}deg); ${iconStyle}"></DIV>`;
                    break;
                case HELICOPTERICON:
                    h = `<DIV CLASS="helicoptericon" style="background-position: 0px 0; transform: translate(-6px,-6px) rotate(${ship.cog}deg); ${iconStyle}"></DIV>`;
                    break;
                default:
                    console.log("Error: shipicon undefined.");
            }

            return L.divIcon({ html: h, className: 'undefined' });
        }

        // Inspired by: https://gis.stackexchange.com/questions/382087/how-to-remove-leaflet-tooltiplabel-collision
        function hasOverlap(r1, r2) {
            return (!(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom));
        }

        function addTooltip(rects, m) {
            if (m == null) return;

            m.openTooltip();
            const r = m.getTooltip()._container.getBoundingClientRect();

            for (var i = 0; i < rects.length; i++) {
                if (hasOverlap(r, rects[i])) {
                    m.getTooltip().toggle();
                    return;
                }
            }

            rects.push(r);
        }

        function updateTooltips() {
            if (!settings.labels) return;

            let rects = [];

            if (hover_mmsi in markers) addTooltip(rects, markers[hover_mmsi]);
            if (hover_mmsi != card_mmsi && card_mmsi in markers) addTooltip(rects, markers[card_mmsi]);

            for (let [mmsi, m] of Object.entries(markers)) {
                if (mmsi == card_mmsi || mmsi == hover_mmsi) continue;
                if (settings.tooltipOverlap)
                    m.openTooltip();
                else
                    addTooltip(rects, m);
            }
        }

        function startHover(m) {

            if (hover_mmsi != null) endHover(hover_mmsi);

            hover_mmsi = m;

            if (!settings.labels) {
                if (hover_mmsi != null && hover_mmsi in markers) {
                    markers[hover_mmsi].openTooltip();
                }
            }
            else {
                updateTooltips();
            }

            if (!(hover_mmsi in shipsDB)) return;

            let ship = shipsDB[hover_mmsi].raw;

            plotShip(ship);
            removeTrack(hover_mmsi);
            plotTrack(hover_mmsi);
        }

        function endHover(m) {
            m = hover_mmsi;
            hover_mmsi = null;

            if (!settings.labels) {
                if (m != null && m in markers)
                    markers[m].closeTooltip();
            }
            else {
                updateTooltips();
            }

            if (m in shipsDB) {
                let ship = shipsDB[m].raw;
                if (ship)
                    plotShip(ship);
            }

            removeTrack(m);
            plotTrack(m);
            clearHoverMarker();

        }

        function saveSettings() {

            if (map !== undefined) {
                settings.lat = map.getCenter().lat;
                settings.lon = map.getCenter().lng;
                settings.zoom = map.getZoom();
            }

            const scRows = document.querySelectorAll('.shipcard-content-row');

            const selectedRows = [];
            scRows.forEach(row => {
                const rowClasses = row.getAttribute('class');
                selectedRows.push(rowClasses.includes('shipcard-max-only') ? 0 : 1);
            });

            settings.shipcard_max = isShipcardMax();
            settings.shipcard_rows = selectedRows;

            localStorage.settings = JSON.stringify(settings);
        }

        function loadSettings() {

            try {
                const localStorageSettings = localStorage.getItem('settings');
                if (localStorageSettings !== null) {
                    const ls = JSON.parse(localStorageSettings);
                    settings = { ...settings, ...ls };
                }
            } catch (error) {
                console.log(error);
                return;
            }

            if (!shipcardismax())
                toggleShipcardSize();

            if (settings.shipcard_rows && settings.shipcard_rows.length > 0) {
                const rows = document.querySelectorAll('.shipcard-content-row');

                rows.forEach((row, index) => {
                    if (settings.shipcard_rows[index] == 1) {
                        row.setAttribute('class', 'shipcard-content-row shipcard-row-selected');
                    }
                    else {
                        row.setAttribute('class', 'shipcard-content-row shipcard-max-only');
                    }
                });
                if (settings.shipcard_max != shipcardismax()) {
                    toggleShipcardSize();
                }
            }
        }

        function loadSettingsFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            for (const [key, value] of urlParams.entries())
                if (settings.hasOwnProperty(key))
                    settings = { ...settings, [key]: value };

            settings.dark_mode = settings.dark_mode == "true" || settings.dark_mode == true;
        }

        function updateShipShape(ship) {
            if (ship.mmsi in ship_shape && ship_shape[ship.mmsi] != null)
                map.removeLayer(ship_shape[ship.mmsi]);

            ship_shape[ship.mmsi] = drawShipOutline(ship);
        }

        function plotShip(ship) {

            if (ship.mmsi in markers) {
                if (ship.mmsi != hover_mmsi) markers[ship.mmsi].setIcon(getIcon(ship)); // bug in leaflet??
                markers[ship.mmsi].setLatLng([ship.lat, ship.lon]);
                markers[ship.mmsi].getTooltip().setContent(getTooltipContent(ship));

            } else {
                markers[ship.mmsi] = L.marker([ship.lat, ship.lon], { icon: getIcon(ship) }).addTo(map);

                markers[ship.mmsi].on('click', function (e) { showShipcard(ship.mmsi); });
                markers[ship.mmsi].on('mouseover', function (e) { startHover(ship.mmsi); });
                markers[ship.mmsi].on('mouseout', function (e) { endHover(ship.mmsi); });
                markers[ship.mmsi].on('contextmenu', function (e) { showContextMenu(event, ship.mmsi, [/*'settings', 'ctx-map',*/ 'mmsi', 'mmsi-map']); });

                createTooltip(ship);
            }

            updateShipShape(ship);
            if (hover_mmsi == ship.mmsi)
                setHoverMarker([ship.lat, ship.lon]);
        }

        function mapResetView(z, m) {
            if (m && m in shipsDB) {
                let ship = shipsDB[m].raw;
                map.setView([ship.lat, ship.lon], Math.min(Math.max(z, map.getZoom() + 1), map.getMaxZoom()));
            }
            else
                map.setView(marker_focus.getLatLng(), Math.min(Math.max(z, map.getZoom() + 1), map.getMaxZoom()));
            shipcardMinIfMaxonMobile();
        }

        function shipcardVisible() {
            return document.getElementById('shipcard').classList.contains('visible');
        }

        async function toggleTrack(m) {

            if (m in marker_tracks) {
                removeTrack(m);
                deletePath(m);
            }
            else {
                await showTrack(m);
                shipcardMinIfMaxonMobile();
            }
        }

        async function toggleTrackCard() {

            toggleTrack(card_mmsi)
            document.getElementById("shipcard_track").innerText = (card_mmsi in marker_tracks) ? "Hide Track" : "Show Track";
        }

        function pinStation() {
            pinVessel("STATION");
        }

        function pinVessel(m) {
            settings.center_point = m;
            settings.fix_center = true;
            saveSettings();
            plotStation();
        }

        function unpinCenter() {
            settings.fix_center = false;
            saveSettings();
            plotStation();
        }

        function removeTrack(m) {
            if (m in marker_tracks) {
                map.removeLayer(marker_tracks[m])
                delete marker_tracks[m];
                if (m == card_mmsi)
                    document.getElementById("shipcard_track").innerText = "Show Track";
            }
        }

        function deletePath(m) {
            if (m in paths) delete paths[m];
        }

        function removeAllTracks() {
            for (var m in marker_tracks) {
                removeTrack(m);
            }
        }

        function deleteAllTracks() {
            removeAllTracks();
            paths = {};
        }

        function plotTrack(m) {

            if (m == null || !(m in markers) || !(m in paths)) return;

            const path = paths[m];

            const latLngs = [];

            for (var i = 0; i < Math.min(path.length, 250); i++) {
                latLngs.push([path[i].lat, path[i].lon]);
            }

            if (m == hover_mmsi)
                marker_tracks[m] = new L.polyline(latLngs, { color: '#12a5ed', opacity: 0.85, weight: 2 }).addTo(map);
            else
                marker_tracks[m] = new L.polyline(latLngs, { color: '#12a5ed', opacity: 0.7, weight: 1 }).addTo(map);

            if (m == card_mmsi)
                document.getElementById("shipcard_track").innerText = "Hide Track";
        }


        async function showTrack(m) {

            try {
                a = await fetch("path.json?" + m);
                p = await a.json()
            }
            catch (error) {
                console.log("Error loading path: " + error);
                return;
            }

            if (m in p) {
                paths[m] = p[m];
            }
            else {
                console.log("No path found for " + m);
                return;
            }

            removeTrack(m);
            plotTrack(m);

            if (m == card_mmsi)
                document.getElementById("shipcard_track").innerText = "Hide Track";

        }

        async function updateTrack() {

            if (Object.keys(marker_tracks).length == 0)
                return true;

            try {
                var mmsi_str = Object.keys(marker_tracks).join(',');
                a = await fetch("path.json?" + mmsi_str);
                paths = await a.json()
            }
            catch (error) {
                console.log("Error loading path: " + error);
                paths = {};
                return false;
            }

            removeAllTracks();
            for (var mmsi in paths) {
                if (paths.hasOwnProperty(mmsi)) {
                    if (mmsi in shipsDB && paths[mmsi].length > 0) {
                        shipsDB[mmsi].raw.lat = paths[mmsi][0].lat;
                        shipsDB[mmsi].raw.lon = paths[mmsi][0].lon;
                        plotTrack(mmsi);
                    }
                }
            }
            return true;
        }

        function isShipcardMax() {

            var e = document.getElementById('shipcard').classList;
            return e.contains('shipcard-ismax');
        }

        function clearFocusMarker() {
            if (marker_focus != null) {
                map.removeLayer(marker_focus);
                marker_focus = null;
            }
        }

        function setFocusMarker(latlon) {
            if (marker_focus == null) {
                marker_focus = L.circleMarker(latlon, { interactive: false, color: 'red', radius: 20, weight: 4, fillOpacity: 0, pane: "locationMarker", className: "pulse" });
                marker_focus.addTo(map);
            }
            else
                marker_focus.setLatLng(latlon);
        }

        function clearHoverMarker() {

            if (marker_hover != null) {
                map.removeLayer(marker_hover);
                marker_hover = null;
            }
        }

        function setHoverMarker(latlon) {

            if (marker_hover == null) {
                marker_hover = L.circleMarker(latlon, { interactive: false, color: 'orange', radius: 16, weight: 4, fillOpacity: 0, pane: "locationMarker" });
                marker_hover.addTo(map);
            }
            else
                marker_hover.setLatLng(latlon);
        }

        function getStringfromMsgType(m) {
            let s = "";
            let delim = "";
            for (i = 1; i <= 27; i++)
                if ((m & (1 << i)) != 0) {
                    s += delim + Number(i).toFixed(0);
                    delim = ", ";
                }
            return s;
        }

        function getStringfromGroup(m) {

            let s = "";
            let delim = "";
            let count = 0;

            for (i = 0; i < 32; i++) {
                let mask = 1 << i;
                if ((m & mask) !== 0) {
                    if (count == 4) {
                        s += delim + "...";
                        break;
                    }
                    s += delim + Number(i + 1).toFixed(0);
                    delim = ", ";
                    count++;
                }
            }
            return s;
        }

        function getStringfromChannels(m) {
            let s = "";
            let delim = "";
            for (i = 0; i <= 3; i++)
                if ((m & (1 << i)) != 0) {
                    s += delim + String.fromCharCode(65 + i);
                    delim = ", ";
                }
            return s;
        }

        function setShipcardValidation(v) {

            document.getElementById('shipcard_header').classList.remove("shipcard-validated", "shipcard-not-validated", "shipcard-dubious");

            switch (v) {
                case 1: document.getElementById('shipcard_header').classList.add("shipcard-validated"); break;
                case -1: document.getElementById('shipcard_header').classList.add("shipcard-dubious"); break;
                default: document.getElementById('shipcard_header').classList.add("shipcard-not-validated");
            }
        }

        function populateShipcard() {


            if (!(card_mmsi in shipsDB)) {

                document.getElementById('shipcard_content').querySelectorAll('span:nth-child(2)').forEach(e => e.innerHTML = null);
                document.getElementById('shipcard_header_title').innerHTML = "<b style='color:red;'>Out of range</b>";
                document.getElementById("shipcard_mmsi").innerHTML = card_mmsi;

                clearFocusMarker();
                removeTrack(card_mmsi);
                deletePath(card_mmsi);
                return;
            }

            let ship = shipsDB[card_mmsi].raw;

            document.getElementById('shipcard_header_title').innerHTML = getFlag(ship.country) + (getShipName(ship) || ship.mmsi);

            setShipcardValidation(ship.validated);

            // verbatim copies
            ['destination', 'mmsi', 'count', 'imo'].forEach(e => document.getElementById('shipcard_' + e).innerHTML = ship[e]);

            // round and add units
            [{ id: "cog", u: "&deg", d: 0 },
            { id: "heading", u: "&deg", d: 0 },
            { id: "level", u: "dB", d: 1 },
            { id: "ppm", u: "ppm", d: 1 }
            ].forEach(el => document.getElementById("shipcard_" + el.id).innerHTML = ship[el.id] ? Number(ship[el.id]).toFixed(el.d) + " " + el.u : null);

            document.getElementById("shipcard_country").innerHTML = getCountryName(ship.country);
            document.getElementById("shipcard_callsign").innerHTML = getCallSign(ship);
            document.getElementById("shipcard_msgtypes").innerHTML = getStringfromMsgType(ship.msg_type);

            document.getElementById("shipcard_last_group").innerHTML = getStringfromGroup(ship.last_group);
            document.getElementById("shipcard_sources").innerHTML = getStringfromGroup(ship.group_mask);

            document.getElementById("shipcard_channels").innerHTML = getStringfromChannels(ship.channels);
            document.getElementById('shipcard_type').innerHTML = getTypeVal(ship);
            document.getElementById('shipcard_shiptype').innerHTML = getShipTypeVal(ship.shiptype);
            document.getElementById("shipcard_status").innerHTML = getStatusVal(ship);
            document.getElementById("shipcard_last_signal").innerHTML = getDeltaTimeVal(ship.last_signal);
            document.getElementById("shipcard_eta").innerHTML = (ship.eta_month != null && ship.eta_hour != null && ship.eta_day != null && ship.eta_minute != null) ? getEtaVal(ship) : null;
            document.getElementById("shipcard_lat").innerHTML = ship.lat ? getLatVal(ship) : null;
            document.getElementById("shipcard_lon").innerHTML = ship.lon ? getLonVal(ship) : null;

            document.getElementById("shipcard_speed").innerHTML = ship.speed ? getSpeedVal(ship.speed) + " " + getSpeedUnit() : null;
            document.getElementById("shipcard_distance").innerHTML = ship.distance ? getDistanceVal(ship.distance) + " " + getDistanceUnit() : null;
            document.getElementById("shipcard_draught").innerHTML = ship.draught ? getDimensionVal(ship.draught) + " " + getDimensionUnit() : null;
            document.getElementById("shipcard_dimension").innerHTML = (ship.to_bow != null && ship.to_stern != null && ship.to_port != null && ship.to_starboard != null) ? getDimensionVal(ship.to_bow + ship.to_stern) + " " + getDimensionUnit() + " x " + getDimensionVal(ship.to_port + ship.to_starboard) + " " + getDimensionUnit() : null;

            document.getElementById("shipcard_track").innerText = (card_mmsi in marker_tracks) ? "Hide Track" : "Show Track";
        }

        function shipcardMinIfMaxonMobile() {
            if (shipcardVisible() && window.matchMedia("(max-height: 1000px) and (max-width: 500px)").matches && isShipcardMax()) {
                toggleShipcardSize();
            }
        }

        function plotStation() {
            const hasStation = station == null || !station.hasOwnProperty("lat") || !station.hasOwnProperty("lon");
            const hasMMSIcenter = settings.center_point && settings.center_point != "STATION" && settings.center_point in shipsDB;

            // plot station on map
            if (hasStation) {
                if (marker_station) {
                    map.removeLayer(marker_station);
                    marker_station = null;
                }
            } else {
                if (marker_station == null) {
                    let stationIcon = L.divIcon({
                        html: `<div class="stationIcon"><i class="cell_tower_icon"></i><div></div></div>`,
                        iconSize: [18, 18],
                        iconAnchor: [8, 9],
                        className: 'myDivIcon'
                    });

                    if (station.hasOwnProperty('mmsi') && station.mmsi != 0) {
                        stationIcon = L.divIcon({
                            html: `<div class="ownShipIcon"><i class="cell_tower_icon"></i><div></div></div>`,
                            iconSize: [18, 18],
                            iconAnchor: [8, 9],
                            className: 'myDivIcon'
                        });
                    }

                    marker_station = L.marker([station.lat, station.lon], { interactive: true, icon: stationIcon, pane: 'stationPane' });
                    marker_station.on('contextmenu', function (e) { showContextMenu(event, 0, [/*'settings','ctx-map',*/'ctx-menu', 'station']); });
                    marker_station.addTo(map);
                }
                else {
                    marker_station.setLatLng([station.lat, station.lon]);
                }
            }

            // MMSI is driving center but does not exist
            if (!hasMMSIcenter && settings.center_point != "STATION") {
                settings.center_point = "STATION";
                settings.fix_center = false;
            }

            if (settings.center_point == "STATION") {
                center = station;
            }
            else {
                center = {};
                if (hasMMSIcenter) {
                    let ship = shipsDB[settings.center_point].raw;
                    if (ship.lat != null && ship.lon != null) {
                        center = { lat: ship.lat, lon: ship.lon };
                    }
                }
            }

            // plot the center on the map
            if (!settings.fix_center || center == null || !center.hasOwnProperty("lat") || !center.hasOwnProperty("lon")) {
                if (marker_center) {
                    map.removeLayer(marker_center);
                    marker_center = null;
                }
            }
            else {
                if (marker_center == null) {
                    marker_center = L.circleMarker([center.lat, center.lon], { interactive: false, color: 'black', radius: 12, weight: 4, fillOpacity: 0, pane: "locationMarker" })
                    marker_center.addTo(map);
                }
                else {
                    marker_center.setLatLng([center.lat, center.lon]);
                }
            }

            if (settings.fix_center && center != null && center.hasOwnProperty("lat") && center.hasOwnProperty("lon")) {
                map.panTo([center.lat, center.lon]);
                settings.lat = center.lat;
                settings.lon = center.lon;
            }
        }

        function showShipcard(m) {

            const aside = document.getElementById('shipcard');
            const visible = shipcardVisible();

            ship = m in shipsDB ? shipsDB[m].raw : null;
            ship_old = card_mmsi in shipsDB ? shipsDB[card_mmsi].raw : null;

            if (m != null && !visible) {
                aside.classList.toggle('visible');
            }
            else if (visible && m == null) {
                aside.classList.toggle('visible');
                clearFocusMarker();
            }

            if (shipcardVisible()) setFocusMarker([ship.lat, ship.lon]);

            card_mmsi = m;

            if (ship != null) updateShipShape(ship);
            if (ship_old != null) updateShipShape(ship_old);

            if (shipcardVisible()) {
                populateShipcard();
                if (!map.getBounds().contains(marker_focus.getLatLng())) {
                    map.setView(marker_focus.getLatLng());
                }

                if (!visible) shipcardMinIfMaxonMobile();
            }

            updateTooltips();
        }

        function toggleTooltipStyling() {
            settings.tooltipLean = !settings.tooltipLean;
            if (!settings.labels) settings.labels = true;
            saveSettings();
            for (let [key, m] of Object.entries(markers)) {
                const cls = settings.tooltipLean ? 'leaflet-tooltiplabel' : 'leaflet-tooltip';
                markers[key].unbindTooltip();
                createTooltip(shipsDB[key].raw);
            }
            updateTooltips();
        }

        function toggleTooltipOverlap() {
            settings.tooltipOverlap = !settings.tooltipOverlap
            updateTooltips();
        }

        async function updateMap() {
            let ok = false;

            ok = await fetchShips();
            if (!ok) return;

            ok = await updateTrack();
            //if(!ok) return;

            if (settings.setcoord == "true" || settings.setcoord == true) {
                if (station != null && station.hasOwnProperty("lat") && station.hasOwnProperty("lon")) {
                    settings.setcoord = false;
                    map.panTo([station.lat, station.lon]);
                    saveSettings();
                }
            }

            if (shipcardVisible()) populateShipcard();

            for (let [mmsi, entry] of Object.entries(shipsDB)) {
                let ship = entry.raw;
                if (ship.lat != null && ship.lon != null && ship.lat != 0 && ship.lon != 0 && ship.lat < 90 && ship.lon < 180) {
                    plotShip(ship)
                }
            }

            for (let [key, m] of Object.entries(markers)) {
                if (!shipsDB.hasOwnProperty(parseInt(key))) {
                    if (m != null) map.removeLayer(m);
                    delete markers[parseInt(key)];
                }
            }

            for (let [key, m] of Object.entries(ship_shape)) {
                if (!shipsDB.hasOwnProperty(parseInt(key))) {
                    if (m != null) map.removeLayer(m);
                    delete ship_shape[parseInt(key)];
                }
            }


            if (!(hover_mmsi != null && hover_mmsi in shipsDB)) {
                clearHoverMarker();
            }

            updateTooltips();

            if (card_mmsi != null && card_mmsi > 0 && markers[card_mmsi] != undefined) {
                setFocusMarker(markers[card_mmsi].getLatLng());
            }

            updateMarkerCount();
            plotStation(station);
            await plotRange();
        }


        function updateDarkMode() {
            document.documentElement.classList.toggle("dark", settings.dark_mode);

            const chartsToUpdateMulti = [chart_minutes, chart_hours, chart_days, chart_seconds];
            const chartsToUpdateLevel = [chart_level];
            const chartsToUpdateSingle = [chart_distance_day, chart_distance_hour, chart_ppm, chart_minute_vessel, chart_ppm_minute];
            const chartsToUpdateRadar = [chart_radar_day, chart_radar_hour];

            chartsToUpdateMulti.forEach(chart => {
                updateColorMulti(chart);
                chart.update();
            });

            chartsToUpdateSingle.forEach(chart => {
                updateColorSingle(chart);
                chart.update();
            });

            chartsToUpdateLevel.forEach(chart => {
                const colorVariables = ['--chart1-color', '--chart1-color', '--chart1-color'];
                updateChartColors(chart, colorVariables);
                chart.update();
            });
            chartsToUpdateRadar.forEach(chart => {
                updateColorRadar(chart);
                chart.update();
            });

            updateRangeColor();
            updateMapLayer();
        }

        function toggleDarkMode() {

            settings.dark_mode = !settings.dark_mode;
            updateDarkMode();
            saveSettings();
        }

        function refresh_data() {

            if (!document.hidden) {
                if (!updateInProgress) {
                    updateInProgress = true;

                    try {
                        if (settings.tab == "map") {
                            updateMap();
                            map.invalidateSize();
                        } else if (settings.tab == "stat") {
                            updateStatistics();
                        } else if (settings.tab == "plots") {
                            updatePlots();
                        } else if (settings.tab == "ships") {
                            updateShipTable();
                        }
                    } catch (error) {
                        // Handle the error if needed
                        console.error(error);
                    } finally {
                        updateInProgress = false;
                    }
                }
            }
        }

        async function openFocus(m, z) {
            await fetchShips(false);

            selectMapTab(m);
            if (z) mapResetView(z);
            else mapResetView(13);

            showTrack(m);
        }

        function activateTab(b, a) {

            hideMenuifSmall();

            Array.from(document.getElementById("menubar").children).forEach(e => e.className = e.className.replace(" active", ""))
            Array.from(document.getElementById("menubar_mini").children).forEach(e => e.className = e.className.replace(" active", ""))

            tabcontent = document.getElementsByClassName("tabcontent");

            for (i = 0; i < tabcontent.length; i++)
                tabcontent[i].style.display = "none";

            document.getElementById(a).style.display = "block";

            document.getElementById(a + "_tab").className += " active";
            document.getElementById(a + "_tab_mini").className += " active";

            settings.tab = a;
            saveSettings();

            clearInterval(interval);
            refresh_data();
            interval = setInterval(refresh_data, refreshIntervalMs)

            if (a == "realtime") {
                if (evtSource == null) {
                    evtSource = new EventSource("/sse");
                    const sseDataDiv = document.getElementById("realtime_content");

                    evtSource.addEventListener('nmea', function (e) {
                        if (rtCount > 50) {
                            sseDataDiv.innerHTML = "";
                            rtCount = 0;
                        }
                        sseDataDiv.innerText = e.data + "\n" + sseDataDiv.innerText ;
                        rtCount = rtCount + 1;
                    }, false);
                }
            }
            else {
                if (evtSource != null) {
                    evtSource.close();
                    evtSource = null;
                }
            }
        }

        function selectMapTab(m) {

            document.getElementById('map_tab').click();
            if (m in shipsDB)
                showShipcard(m)
        }

        function selectTab() {
            if (settings.tab != "realtime" && settings.tab != "about" && settings.tab != "map" && settings.tab != "plots" && settings.tab != "ships" && settings.tab != "stat") {
                settings.tab = "stat";
                alert("Invalid tab specified");
            }
            document.getElementById(settings.tab + "_tab").click();
        }

        async function loadPlugins() {
            try {
                const response = await fetch('config.js');
                const config = await response.text();
                window.eval(config);

            } catch (error) {
                console.error(error);
                alert("Error loading plugins: " + error);
            }
        }

        function updateAndroid() {
            if (isAndroid()) {
                var elements = document.querySelectorAll('.noandroid');
                for (var i = 0; i < elements.length; i++) {
                    elements[i].style.display = 'none';
                }
            }
        }

        function showAboutDialog() {
            const message = `
                    <div style="display: flex; align-items: center; margin-top: 10px;">
                    <span style="text-align: center; margin-right: 10px;"><i style="font-size: 40px" class="directions_boat_icon"></i></span>
                    <span>
                    <a href="https://github.com/jvde-github/AIS-catcher"><b style="font-size: 1.6em;">AIS-catcher</b></a>
                    <br>
                    <b style="font-size: 0.8em;">&copy; 2021-2023 jvde.github@gmail.com</b>
                    </span>
                    </div>
                    <p>
                    AIS-catcher is a research and educational tool, provided under the
                    <a href="https://github.com/jvde-github/AIS-catcher/blob/e66a4481e62d8f1775700e5f51fb7ad9ea569a12/LICENSE">GNU GPL v3 license</a>.
                    It is not reliable for navigation and safety of life or property.
                    Radio reception and handling regulations vary by region, so check your local administration's rules. Illegal use is strictly prohibited.
                    </p>
                    <p>
                    The web-interface gratefully uses the following libraries:
                    <a href="https://www.chartjs.org/docs/latest/charts/line.html" rel="nofollow">chart.js</a>,
                    <a href="https://www.chartjs.org/chartjs-plugin-annotation/latest/" rel="nofollow">chart.js annotation plugin</a>,
                    <a href="https://leafletjs.com/" rel="nofollow">leaflet</a>,
                    <a href="https://fonts.google.com/icons?selected=Material+Icons" rel="nofollow">Material Design Icons</a>,
                    <a href="https://tabulator.info/" rel="nofollow">tabulator</a>,
                    <a href="https://github.com/markedjs/marked">marked</a>, and
                    <a href="https://github.com/lipis/flag-icons">flag-icons</a>. Please consult the links for the respective licenses.
                    </p>`;


            showDialog("About...", message)
        }

        function showWelcome() {
            if (settings.welcome == true || settings.welcome == "true" && !isAndroid())
                showAboutDialog();

            settings.welcome = false;
            saveSettings();
        }

        function isAndroid() {
            return (settings.android === true || settings.android === 'true');
        }

        // for overwrite and insert code where needed
        function main() {
            plugins_main.forEach(function (p) { p(); });
        }

        function setupAbout() {
            fetchAbout().then(s => {
                var scriptElement = document.createElement('script');
                scriptElement.src = 'https://cdn.jsdelivr.net/npm/marked/marked.min.js';
                document.head.appendChild(scriptElement);

                scriptElement.onload = function () {
                    document.getElementById("about_content").innerHTML = marked.parse(s);
                };
            }).catch(error => {
                alert("Error loading about.md: " + error);
                aboutMDpresent = false;
            });
        }

        function init_preSettings() { }
        function init_postSettings() { }
        function init_postTabsInit() { }

        // add the default tile layers and overlay
        if (typeof L !== "undefined") {

            addTileLayer("OpenStreetMap", L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>' }));
            addTileLayer("Positron", L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/attributions">CARTO</a>', subdomains: 'abcd', maxZoom: 20 }));
            addTileLayer("DarkMatter", L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/attributions">CARTO</a>', subdomains: 'abcd', maxZoom: 20 }));
            addTileLayer("Voyager", L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSMN</a> &copy; <a href="https://carto.com/attributions">CARTO</a>', subdomains: 'abcd', maxZoom: 20 }))
            addTileLayer("Satellite", L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Esri et al.' }));

            addOverlayLayer("OpenSeaMap", L.tileLayer('http://tiles.openseamap.org/seamark/{z}/{x}/{y}.png', { attribution: 'Map data: &copy; <a href="http://www.openseamap.org">OSM</a>', maxZoom: 18 }));
        }

        let mdabout = "This content can be defined by the owner of the station";

        console.log("Starting plugin code")

    </script>

    <script src="config.js"></script>

    <script>
        console.log("Plugin loading completed");

        init_preSettings();

        console.log("Load settings")
        loadSettings();

        console.log("Load settings from URL parameters")

        if (settings.loadURL)
            loadSettingsFromURL();

        init_postSettings();

        updateAndroid();

        console.log("Setup tabs");
        initFullScreen();
        initPlots();

        if (typeof L !== "undefined") {
            initMap();
        }

        updateDarkMode();

        init_postTabsInit();

        console.log("Switch to active tab");
        selectTab();

        let urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('mmsi'))
            openFocus(urlParams.get('mmsi'), urlParams.get('zoom'));

        saveSettings();

        if (aboutMDpresent == false) {
            document.getElementById("about_tab").style.display = "none";
            document.getElementById("about_tab_mini").style.display = "none";
        }
        else {
            setupAbout();
        }

        if (typeof realtime_enabled === 'undefined' || realtime_enabled === false) {
            document.getElementById("realtime_tab").style.display = "none";
            document.getElementById("realtime_tab_mini").style.display = "none";
        }
        showWelcome();

        if (isAndroid()) showMenu();
        main();

    </script>
</body>
</html>
